---
title: Magas rendelkezésre állású Kubernetes minta az Azure és Azure Stack hub használatával
description: Megtudhatja, hogyan biztosít magas rendelkezésre állást a Kubernetes-fürt számára az Azure és a Azure Stack hub használatával.
author: BryanLa
ms.topic: article
ms.date: 12/03/2020
ms.author: bryanla
ms.reviewer: bryanla
ms.lastreviewed: 12/03/2020
ms.openlocfilehash: 454cc0a0531882b7a8ec050a461420ce13eebcfe
ms.sourcegitcommit: df7e3e6423c3d4e8a42dae3d1acfba1d55057258
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 12/09/2020
ms.locfileid: "96911792"
---
# <a name="high-availability-kubernetes-cluster-pattern"></a><span data-ttu-id="5934c-103">Magas rendelkezésre állású Kubernetes-fürt mintája</span><span class="sxs-lookup"><span data-stu-id="5934c-103">High availability Kubernetes cluster pattern</span></span>

<span data-ttu-id="5934c-104">Ez a cikk azt ismerteti, hogyan lehet az Azure Stack hub Azure Kubernetes Service (ak) motorjának használatával egy magasan elérhető Kubernetes-alapú infrastruktúrát feldolgozni és működtetni.</span><span class="sxs-lookup"><span data-stu-id="5934c-104">This article describes how to architect and operate a highly available Kubernetes-based infrastructure using Azure Kubernetes Service (AKS) Engine on Azure Stack Hub.</span></span> <span data-ttu-id="5934c-105">Ez a forgatókönyv gyakori a kritikus fontosságú számítási feladatokkal rendelkező vállalatok számára, amelyek nagy mértékben korlátozott és szabályozott környezetekben vannak.</span><span class="sxs-lookup"><span data-stu-id="5934c-105">This scenario is common for organizations with critical workloads in highly restricted and regulated environments.</span></span> <span data-ttu-id="5934c-106">Többek között pénzügyi, védelmi és kormányzati szervezetek.</span><span class="sxs-lookup"><span data-stu-id="5934c-106">Organizations in domains such as finance, defense, and government.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="5934c-107">Kontextus és probléma</span><span class="sxs-lookup"><span data-stu-id="5934c-107">Context and problem</span></span>

<span data-ttu-id="5934c-108">Számos szervezet olyan felhőalapú megoldásokat fejleszt, amelyek a legkorszerűbb szolgáltatásokat és technológiákat, például a Kubernetes használják.</span><span class="sxs-lookup"><span data-stu-id="5934c-108">Many organizations are developing cloud-native solutions that leverage state-of-the-art services and technologies like Kubernetes.</span></span> <span data-ttu-id="5934c-109">Bár az Azure a világ legtöbb régiójában biztosít adatközpontokat, időnként előfordulnak olyan Edge-használati esetek és forgatókönyvek, ahol az üzleti szempontból kritikus fontosságú alkalmazásokat egy adott helyen kell futtatni.</span><span class="sxs-lookup"><span data-stu-id="5934c-109">Although Azure provides datacenters in most regions of the world, sometimes there are edge use-cases and scenarios where business critical applications must run in a specific location.</span></span> <span data-ttu-id="5934c-110">A szempontok a következők:</span><span class="sxs-lookup"><span data-stu-id="5934c-110">Considerations include:</span></span>

- <span data-ttu-id="5934c-111">Hely érzékenysége</span><span class="sxs-lookup"><span data-stu-id="5934c-111">Location sensitivity</span></span>
- <span data-ttu-id="5934c-112">Az alkalmazás és a helyszíni rendszerek közötti késés</span><span class="sxs-lookup"><span data-stu-id="5934c-112">Latency between the application and on-premises systems</span></span>
- <span data-ttu-id="5934c-113">Sávszélesség-megőrzés</span><span class="sxs-lookup"><span data-stu-id="5934c-113">Bandwidth conservation</span></span>
- <span data-ttu-id="5934c-114">Kapcsolatok</span><span class="sxs-lookup"><span data-stu-id="5934c-114">Connectivity</span></span>
- <span data-ttu-id="5934c-115">Szabályozási vagy jogszabályi követelmények</span><span class="sxs-lookup"><span data-stu-id="5934c-115">Regulatory or statutory requirements</span></span>

<span data-ttu-id="5934c-116">Az Azure az Azure Stack hub szolgáltatással együtt a legtöbb ilyen problémával foglalkozik.</span><span class="sxs-lookup"><span data-stu-id="5934c-116">Azure, in combination with Azure Stack Hub, addresses most of these concerns.</span></span> <span data-ttu-id="5934c-117">Az alábbiakban részletesen ismertetjük az Azure Stack hub-on futó Kubernetes sikeres megvalósításának lehetőségeit, döntéseit és szempontjait.</span><span class="sxs-lookup"><span data-stu-id="5934c-117">A broad set of options, decisions, and considerations for a successful implementation of Kubernetes running on Azure Stack Hub is described below.</span></span>

## <a name="solution"></a><span data-ttu-id="5934c-118">Megoldás</span><span class="sxs-lookup"><span data-stu-id="5934c-118">Solution</span></span>

<span data-ttu-id="5934c-119">Ez a minta azt feltételezi, hogy a kényszerek szigorú készletét kell kezelni.</span><span class="sxs-lookup"><span data-stu-id="5934c-119">This pattern assumes that we have to deal with a strict set of constraints.</span></span> <span data-ttu-id="5934c-120">Az alkalmazásnak a helyszínen kell futnia, és az összes személyes adattal nem szabad a nyilvános felhőalapú szolgáltatásokhoz jutnia.</span><span class="sxs-lookup"><span data-stu-id="5934c-120">The application must run on-premises and all personal data must not reach public cloud services.</span></span> <span data-ttu-id="5934c-121">A monitorozási és egyéb nem személyes adatok az Azure-ba küldhetők, és ott is feldolgozhatók.</span><span class="sxs-lookup"><span data-stu-id="5934c-121">Monitoring and other non-PII data can be sent to Azure and be processed there.</span></span> <span data-ttu-id="5934c-122">Az olyan külső szolgáltatások, mint például a nyilvános Container Registry vagy mások is elérhetők, de tűzfalon vagy proxykiszolgálón keresztül is szűrhetők.</span><span class="sxs-lookup"><span data-stu-id="5934c-122">External services like a public Container Registry or others can be accessed but might be filtered through a firewall or proxy server.</span></span>

<span data-ttu-id="5934c-123">Az itt látható minta alkalmazás (az [Azure Kubernetes Service workshop](/learn/modules/aks-workshop/)alapján) úgy van kialakítva, hogy Kubernetes-natív megoldásokat használjon, amikor csak lehetséges.</span><span class="sxs-lookup"><span data-stu-id="5934c-123">The sample application shown here (based on [Azure Kubernetes Service Workshop](/learn/modules/aks-workshop/)) is designed to use Kubernetes-native solutions whenever possible.</span></span> <span data-ttu-id="5934c-124">Ez a kialakítás elkerüli a szállítói zárolást a platform-natív szolgáltatások használata helyett.</span><span class="sxs-lookup"><span data-stu-id="5934c-124">This design avoids vendor lock-in, instead of using platform-native services.</span></span> <span data-ttu-id="5934c-125">Az alkalmazás például egy saját üzemeltetésű MongoDB adatbázis-hátteret használ a Pásti szolgáltatás vagy külső adatbázis-szolgáltatás helyett.</span><span class="sxs-lookup"><span data-stu-id="5934c-125">As an example, the application uses a self-hosted MongoDB database backend instead of a PaaS service or external database service.</span></span>

<span data-ttu-id="5934c-126">[![Alkalmazás minta hibrid](media/pattern-highly-available-kubernetes/application-architecture.png)](media/pattern-highly-available-kubernetes/application-architecture.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="5934c-126">[![Application Pattern Hybrid](media/pattern-highly-available-kubernetes/application-architecture.png)](media/pattern-highly-available-kubernetes/application-architecture.png#lightbox)</span></span>

<span data-ttu-id="5934c-127">Az előző ábrán az Azure Stack hub Kubernetes futó minta alkalmazás architektúrája látható.</span><span class="sxs-lookup"><span data-stu-id="5934c-127">The preceding diagram illustrates the application architecture of the sample application running on Kubernetes on Azure Stack Hub.</span></span> <span data-ttu-id="5934c-128">Az alkalmazás több összetevőből áll, beleértve a következőket:</span><span class="sxs-lookup"><span data-stu-id="5934c-128">The app consists of several components, including:</span></span>

 1) <span data-ttu-id="5934c-129">Egy AK-alapú motoron alapuló Kubernetes-fürt Azure Stack központban.</span><span class="sxs-lookup"><span data-stu-id="5934c-129">An AKS Engine based Kubernetes cluster on Azure Stack Hub.</span></span>
 2) <span data-ttu-id="5934c-130">tanúsítvány [-kezelő](https://www.jetstack.io/cert-manager/), amely a Kubernetes lévő tanúsítványkezelő eszközeit biztosítja a tanúsítványok automatikus igényléséhez a titkosításhoz.</span><span class="sxs-lookup"><span data-stu-id="5934c-130">[cert-manager](https://www.jetstack.io/cert-manager/), which provides a suite of tools for certificate management in Kubernetes, used to automatically request certificates from Let's Encrypt.</span></span>
 3) <span data-ttu-id="5934c-131">Egy Kubernetes-névtér, amely az előtér (Ratings-web), az API (Ratings-API) és az adatbázis (Ratings-mongodb) alkalmazás-összetevőit tartalmazza.</span><span class="sxs-lookup"><span data-stu-id="5934c-131">A Kubernetes namespace that contains the application components for the front end (ratings-web), api (ratings-api), and database (ratings-mongodb).</span></span>
 4) <span data-ttu-id="5934c-132">A bejövő vezérlő, amely a HTTP/HTTPS-forgalmat a Kubernetes-fürtön belüli végpontokra irányítja.</span><span class="sxs-lookup"><span data-stu-id="5934c-132">The Ingress Controller that routes HTTP/HTTPS traffic to endpoints within the Kubernetes cluster.</span></span>

<span data-ttu-id="5934c-133">A minta alkalmazás az alkalmazás architektúrájának szemléltetésére szolgál.</span><span class="sxs-lookup"><span data-stu-id="5934c-133">The sample application is used to illustrate the application architecture.</span></span> <span data-ttu-id="5934c-134">Az összes összetevő példa.</span><span class="sxs-lookup"><span data-stu-id="5934c-134">All components are examples.</span></span> <span data-ttu-id="5934c-135">Az architektúra csak egyetlen alkalmazás-telepítést tartalmaz.</span><span class="sxs-lookup"><span data-stu-id="5934c-135">The architecture contains only a single application deployment.</span></span> <span data-ttu-id="5934c-136">Ha magas rendelkezésre állást szeretne elérni, legalább kétszer futtatjuk az üzembe helyezést két különböző Azure Stack hub-példányon – ezek futhatnak ugyanazon a helyen, vagy két (vagy több) különböző helyen:</span><span class="sxs-lookup"><span data-stu-id="5934c-136">To achieve high availability (HA), we'll run the deployment at least twice on two different Azure Stack Hub instances - they can run either in the same location or in two (or more) different sites:</span></span>

![Infrastruktúra-architektúra](media/pattern-highly-available-kubernetes/aks-azure-architecture.png)

<span data-ttu-id="5934c-138">Az olyan szolgáltatásokat, mint például a Azure Container Registry, a Azure Monitor és más szolgáltatások, az Azure-ban vagy a helyszínen található Azure Stack hub-on kívül futnak.</span><span class="sxs-lookup"><span data-stu-id="5934c-138">Services like Azure Container Registry, Azure Monitor, and others, are hosted outside Azure Stack Hub in Azure or on-premises.</span></span> <span data-ttu-id="5934c-139">Ez a hibrid kialakítás védi a megoldást egyetlen Azure Stack hub-példány KIMARADÁSÁVAL szemben.</span><span class="sxs-lookup"><span data-stu-id="5934c-139">This hybrid design protects the solution against outage of a single Azure Stack Hub instance.</span></span>

## <a name="components"></a><span data-ttu-id="5934c-140">Összetevők</span><span class="sxs-lookup"><span data-stu-id="5934c-140">Components</span></span>

<span data-ttu-id="5934c-141">A teljes architektúra a következő összetevőkből áll:</span><span class="sxs-lookup"><span data-stu-id="5934c-141">The overall architecture consists of the following components:</span></span>

<span data-ttu-id="5934c-142">Az **Azure stack hub** az Azure egy bővítménye, amely a munkaterhelések helyszíni környezetben való futtatását teszi lehetővé az adatközpontban elérhető Azure-szolgáltatások biztosításával.</span><span class="sxs-lookup"><span data-stu-id="5934c-142">**Azure Stack Hub** is an extension of Azure that can run workloads in an on-premises environment by providing Azure services in your datacenter.</span></span> <span data-ttu-id="5934c-143">További információért látogasson el a [Azure stack hub áttekintésére](/azure-stack/operator/azure-stack-overview) .</span><span class="sxs-lookup"><span data-stu-id="5934c-143">Go to [Azure Stack Hub overview](/azure-stack/operator/azure-stack-overview) to learn more.</span></span>

<span data-ttu-id="5934c-144">Az Azure **Kubernetes Service Engine (ak motor)** a felügyelt Kubernetes Service-ajánlat, az Azure Kubernetes Service (ak) mögötti motor, amely jelenleg az Azure-ban érhető el.</span><span class="sxs-lookup"><span data-stu-id="5934c-144">**Azure Kubernetes Service Engine (AKS Engine)** is the engine behind the managed Kubernetes service offering, Azure Kubernetes Service (AKS), that is available in Azure today.</span></span> <span data-ttu-id="5934c-145">Azure Stack hub esetében az AK motorja lehetővé teszi, hogy a Azure Stack hub IaaS képességeivel teljes funkcionalitású, önállóan felügyelt Kubernetes-fürtöket helyezzen üzembe, méretezhetin és frissítsen.</span><span class="sxs-lookup"><span data-stu-id="5934c-145">For Azure Stack Hub, AKS Engine allows us to deploy, scale, and upgrade fully featured, self-managed Kubernetes clusters using Azure Stack Hub's IaaS capabilities.</span></span> <span data-ttu-id="5934c-146">További információt a következő témakörben talál: az [AK-motor áttekintése](https://github.com/Azure/aks-engine) .</span><span class="sxs-lookup"><span data-stu-id="5934c-146">Go to [AKS Engine Overview](https://github.com/Azure/aks-engine) to learn more.</span></span>

<span data-ttu-id="5934c-147">Ismerje meg az [ismert problémákat és korlátozásokat, és](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#known-issues-and-limitations) Ismerkedjen meg a Azure stack hub-beli, az Azure-beli és az AK-beli motorok közötti különbségekkel.</span><span class="sxs-lookup"><span data-stu-id="5934c-147">Go to [Known Issues and Limitations](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#known-issues-and-limitations) to learn more about the differences between AKS Engine on Azure and AKS Engine on Azure Stack Hub.</span></span>

<span data-ttu-id="5934c-148">Az **Azure Virtual Network (VNet)** a hálózati infrastruktúra biztosítására szolgál az egyes Azure stack hubokon a Kubernetes-fürt infrastruktúráját üzemeltető Virtual Machines (VM) esetében.</span><span class="sxs-lookup"><span data-stu-id="5934c-148">**Azure Virtual Network (VNet)** is used to provide the network infrastructure on each Azure Stack Hub for the Virtual Machines (VMs) hosting the Kubernetes cluster infrastructure.</span></span>

<span data-ttu-id="5934c-149">**Azure Load Balancer** a Kubernetes API-végponthoz és az Nginx beáramló vezérlőhöz használható.</span><span class="sxs-lookup"><span data-stu-id="5934c-149">**Azure Load Balancer** is used for the Kubernetes API Endpoint and the Nginx Ingress Controller.</span></span> <span data-ttu-id="5934c-150">A terheléselosztó külső (például internetes) forgalmat irányít át egy adott szolgáltatást biztosító csomópontokra és virtuális gépekre.</span><span class="sxs-lookup"><span data-stu-id="5934c-150">The load balancer routes external (for example, Internet) traffic to nodes and VMs offering a specific service.</span></span>

<span data-ttu-id="5934c-151">A **Azure Container Registry (ACR)** a fürtön üzembe helyezett privát Docker-rendszerképek és Helm-diagramok tárolására szolgál.</span><span class="sxs-lookup"><span data-stu-id="5934c-151">**Azure Container Registry (ACR)** is used to store private Docker images and Helm charts, which are deployed to the cluster.</span></span> <span data-ttu-id="5934c-152">Az AK-motor az Azure AD-identitás használatával tud hitelesíteni a Container Registry.</span><span class="sxs-lookup"><span data-stu-id="5934c-152">AKS Engine can authenticate with the Container Registry using an Azure AD identity.</span></span> <span data-ttu-id="5934c-153">A Kubernetes nem igényel ACR-t.</span><span class="sxs-lookup"><span data-stu-id="5934c-153">Kubernetes doesn't require ACR.</span></span> <span data-ttu-id="5934c-154">Más tároló-nyilvántartásokat is használhat, például a Docker hub-t.</span><span class="sxs-lookup"><span data-stu-id="5934c-154">You can use other container registries, such as Docker Hub.</span></span>

<span data-ttu-id="5934c-155">Az **Azure Repos** olyan verziókövetés-eszközök összessége, amelyek segítségével kezelheti a kódot.</span><span class="sxs-lookup"><span data-stu-id="5934c-155">**Azure Repos** is a set of version control tools that you can use to manage your code.</span></span> <span data-ttu-id="5934c-156">A GitHub vagy más git-alapú Tárházak is használhatók.</span><span class="sxs-lookup"><span data-stu-id="5934c-156">You can also use GitHub or other git-based repositories.</span></span> <span data-ttu-id="5934c-157">További információért látogasson el az [Azure Repos áttekintése oldalra](/azure/devops/repos/get-started/what-is-repos) .</span><span class="sxs-lookup"><span data-stu-id="5934c-157">Go to [Azure Repos Overview](/azure/devops/repos/get-started/what-is-repos) to learn more.</span></span>

<span data-ttu-id="5934c-158">Az **Azure-folyamatok** az Azure DevOps-szolgáltatások részét képezik, és automatizált buildeket, teszteket és üzembe helyezéseket futtatnak.</span><span class="sxs-lookup"><span data-stu-id="5934c-158">**Azure Pipelines** is part of Azure DevOps Services and runs automated builds, tests, and deployments.</span></span> <span data-ttu-id="5934c-159">Harmadik féltől származó CI/CD-megoldásokat is használhat, például a Jenkinst.</span><span class="sxs-lookup"><span data-stu-id="5934c-159">You can also use third-party CI/CD solutions such as Jenkins.</span></span> <span data-ttu-id="5934c-160">További információért látogasson el az [Azure-folyamatok áttekintésére](/azure/devops/pipelines/get-started/what-is-azure-pipelines) .</span><span class="sxs-lookup"><span data-stu-id="5934c-160">Go to [Azure Pipeline Overview](/azure/devops/pipelines/get-started/what-is-azure-pipelines) to learn more.</span></span>

<span data-ttu-id="5934c-161">**Azure monitor** gyűjti és tárolja a mérőszámokat és naplókat, beleértve az Azure-szolgáltatásokra vonatkozó platform-mérőszámokat a megoldásban és az alkalmazás telemetria.</span><span class="sxs-lookup"><span data-stu-id="5934c-161">**Azure Monitor** collects and stores metrics and logs, including platform metrics for the Azure services in the solution and application telemetry.</span></span> <span data-ttu-id="5934c-162">Ezekkel az adatokkal figyelheti az alkalmazást, riasztásokat és irányítópultokat állíthat be, és a hibák kiváltó okának elemzését végezheti el.</span><span class="sxs-lookup"><span data-stu-id="5934c-162">Use this data to monitor the application, set up alerts and dashboards, and perform root cause analysis of failures.</span></span> <span data-ttu-id="5934c-163">A Azure Monitor együttműködik a Kubernetes a vezérlők, a csomópontok és a tárolók, valamint a tároló-naplók és a fő csomópont-naplók metrikáinak összegyűjtéséhez.</span><span class="sxs-lookup"><span data-stu-id="5934c-163">Azure Monitor integrates with Kubernetes to collect metrics from controllers, nodes, and containers, as well as container logs and master node logs.</span></span> <span data-ttu-id="5934c-164">További információért [tekintse meg Azure monitor áttekintést](/azure/azure-monitor/overview) .</span><span class="sxs-lookup"><span data-stu-id="5934c-164">Go to [Azure Monitor Overview](/azure/azure-monitor/overview) to learn more.</span></span>

<span data-ttu-id="5934c-165">Az **azure Traffic Manager** egy DNS-alapú forgalom terheléselosztó, amely lehetővé teszi a forgalom optimális elosztását különböző Azure-régiókba vagy Azure stack hub-környezetek szolgáltatásaiba.</span><span class="sxs-lookup"><span data-stu-id="5934c-165">**Azure Traffic Manager** is a DNS-based traffic load balancer that enables you to distribute traffic optimally to services across different Azure regions or Azure Stack Hub deployments.</span></span> <span data-ttu-id="5934c-166">A Traffic Manager magas rendelkezésre állást és válaszadást is biztosít.</span><span class="sxs-lookup"><span data-stu-id="5934c-166">Traffic Manager also provides high availability and responsiveness.</span></span> <span data-ttu-id="5934c-167">Az alkalmazás-végpontoknak elérhetőnek kell lenniük a kívülről.</span><span class="sxs-lookup"><span data-stu-id="5934c-167">The application endpoints must be accessible from the outside.</span></span> <span data-ttu-id="5934c-168">Más helyszíni megoldások is elérhetők.</span><span class="sxs-lookup"><span data-stu-id="5934c-168">There are other on-premises solutions available as well.</span></span>

<span data-ttu-id="5934c-169">A **Kubernetes bejövő** adatforgalom-vezérlő http (S) útvonalakat tesz elérhetővé egy Kubernetes-fürt szolgáltatásai számára.</span><span class="sxs-lookup"><span data-stu-id="5934c-169">**Kubernetes Ingress Controller** exposes HTTP(S) routes to services in a Kubernetes cluster.</span></span> <span data-ttu-id="5934c-170">Erre a célra az Nginx vagy bármely alkalmas bejövő vezérlő használható.</span><span class="sxs-lookup"><span data-stu-id="5934c-170">Nginx or any suitable ingress controller can be used for this purpose.</span></span>

<span data-ttu-id="5934c-171">A **Helm** egy Kubernetes üzembe helyezésére szolgáló csomagkezelő, amely lehetővé teszi különböző Kubernetes-objektumok, például üzembe helyezések, szolgáltatások, titkos kódok egyetlen "diagramba" való beépítését.</span><span class="sxs-lookup"><span data-stu-id="5934c-171">**Helm** is a package manager for Kubernetes deployment, providing a way to bundle different Kubernetes objects like Deployments, Services, Secrets, into a single "chart".</span></span> <span data-ttu-id="5934c-172">Közzéteheti, telepítheti, vezérelheti a verziószámozást, és frissítheti a diagram objektumait.</span><span class="sxs-lookup"><span data-stu-id="5934c-172">You can publish, deploy, control version management, and update a chart  object.</span></span> <span data-ttu-id="5934c-173">A Azure Container Registry használható tárházként a csomagolt Helm-diagramok tárolásához.</span><span class="sxs-lookup"><span data-stu-id="5934c-173">Azure Container Registry can be used as a repository to store packaged Helm Charts.</span></span>

## <a name="design-considerations"></a><span data-ttu-id="5934c-174">Kialakítási szempontok</span><span class="sxs-lookup"><span data-stu-id="5934c-174">Design considerations</span></span>

<span data-ttu-id="5934c-175">Ez a minta néhány olyan magas szintű szempontot követ, amely részletesebben ismerteti a cikk következő részében ismertetett lépéseket:</span><span class="sxs-lookup"><span data-stu-id="5934c-175">This pattern follows a few high-level considerations explained in more detail in the next sections of this article:</span></span>

- <span data-ttu-id="5934c-176">Az alkalmazás Kubernetes-natív megoldásokat használ a szállítók zárolásának elkerülése érdekében.</span><span class="sxs-lookup"><span data-stu-id="5934c-176">The application uses Kubernetes-native solutions, to avoid vendor lock-in.</span></span>
- <span data-ttu-id="5934c-177">Az alkalmazás egy Services architektúrát használ.</span><span class="sxs-lookup"><span data-stu-id="5934c-177">The application uses a microservices architecture.</span></span>
- <span data-ttu-id="5934c-178">Azure Stack hub nem igényel bejövő kapcsolatot, de engedélyezi a kimenő internetkapcsolatot.</span><span class="sxs-lookup"><span data-stu-id="5934c-178">Azure Stack Hub doesn't need inbound but allows outbound Internet connectivity.</span></span>

<span data-ttu-id="5934c-179">Ezek a javasolt eljárások a valós munkaterhelésekre és forgatókönyvekre is érvényesek lesznek.</span><span class="sxs-lookup"><span data-stu-id="5934c-179">These recommended practices will apply to real-world workloads and scenarios as well.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="5934c-180">Méretezési szempontok</span><span class="sxs-lookup"><span data-stu-id="5934c-180">Scalability considerations</span></span>

<span data-ttu-id="5934c-181">A méretezhetőség fontos, hogy a felhasználók konzisztens, megbízható és jól teljesítő hozzáférést nyújtsanak az alkalmazáshoz.</span><span class="sxs-lookup"><span data-stu-id="5934c-181">Scalability is important to provide users consistent, reliable, and well-performing access to the application.</span></span>

<span data-ttu-id="5934c-182">A minta forgatókönyv az alkalmazás-verem több rétegének méretezhetőségét fedi le.</span><span class="sxs-lookup"><span data-stu-id="5934c-182">The sample scenario covers scalability on multiple layers of the application stack.</span></span> <span data-ttu-id="5934c-183">Az alábbiakban áttekintheti a különböző rétegeket:</span><span class="sxs-lookup"><span data-stu-id="5934c-183">Here's a high-level overview of the different layers:</span></span>

| <span data-ttu-id="5934c-184">Architektúra szintje</span><span class="sxs-lookup"><span data-stu-id="5934c-184">Architecture level</span></span> | <span data-ttu-id="5934c-185">Befolyásolja</span><span class="sxs-lookup"><span data-stu-id="5934c-185">Affects</span></span> | <span data-ttu-id="5934c-186">Hogyan?</span><span class="sxs-lookup"><span data-stu-id="5934c-186">How?</span></span> |
| --- | --- | ---
| <span data-ttu-id="5934c-187">Alkalmazás</span><span class="sxs-lookup"><span data-stu-id="5934c-187">Application</span></span> | <span data-ttu-id="5934c-188">Alkalmazás</span><span class="sxs-lookup"><span data-stu-id="5934c-188">Application</span></span> | <span data-ttu-id="5934c-189">Vízszintes skálázás a hüvelyek/replikák/Container Instances \* száma alapján</span><span class="sxs-lookup"><span data-stu-id="5934c-189">Horizontal scaling based on the number of Pods/Replicas/Container Instances\*</span></span> |
| <span data-ttu-id="5934c-190">Fürt</span><span class="sxs-lookup"><span data-stu-id="5934c-190">Cluster</span></span> | <span data-ttu-id="5934c-191">Kubernetes-fürt</span><span class="sxs-lookup"><span data-stu-id="5934c-191">Kubernetes cluster</span></span> | <span data-ttu-id="5934c-192">A csomópontok száma (1 és 50 között), VM-SKU-size és Node-készletek (az Azure Stack hub-on jelenleg csak egyetlen csomópontos készletet támogat); az KABAi motor méretezési parancsának használata (manuális)</span><span class="sxs-lookup"><span data-stu-id="5934c-192">Number of Nodes (between 1 and 50), VM-SKU-sizes, and Node Pools (AKS Engine on Azure Stack Hub currently supports only a single node pool); using AKS Engine's scale command (manual)</span></span> |
| <span data-ttu-id="5934c-193">Infrastruktúra</span><span class="sxs-lookup"><span data-stu-id="5934c-193">Infrastructure</span></span> | <span data-ttu-id="5934c-194">Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="5934c-194">Azure Stack Hub</span></span> | <span data-ttu-id="5934c-195">A csomópontok, a kapacitás és a skálázási egységek száma egy Azure Stack hub üzemelő példányon belül</span><span class="sxs-lookup"><span data-stu-id="5934c-195">Number of nodes, capacity, and scale units within an Azure Stack Hub deployment</span></span> |

<span data-ttu-id="5934c-196">\* A Kubernetes horizontális Pod autoskálázás (HPA) használata; Automatikus metrika-alapú skálázás vagy vertikális skálázás a Container instances (CPU/memória) méretezésével.</span><span class="sxs-lookup"><span data-stu-id="5934c-196">\* Using Kubernetes' Horizontal Pod Autoscaler (HPA); automated metric-based scaling or vertical scaling by sizing the container instances (cpu/memory).</span></span>

<span data-ttu-id="5934c-197">**Azure Stack hub (infrastruktúra szintje)**</span><span class="sxs-lookup"><span data-stu-id="5934c-197">**Azure Stack Hub (infrastructure level)**</span></span>

<span data-ttu-id="5934c-198">Az Azure Stack hub-infrastruktúra ennek a megvalósításnak az alapja, mivel Azure Stack hub fizikai hardveren fut egy adatközpontban.</span><span class="sxs-lookup"><span data-stu-id="5934c-198">The Azure Stack Hub infrastructure is the foundation of this implementation, because Azure Stack Hub runs on physical hardware in a datacenter.</span></span> <span data-ttu-id="5934c-199">A hub hardver kiválasztásakor meg kell adnia a CPU-t, a memória sűrűségét, a tárolási konfigurációt és a kiszolgálók számát.</span><span class="sxs-lookup"><span data-stu-id="5934c-199">When selecting your Hub hardware, you need to make choices for CPU, memory density, storage configuration, and number of servers.</span></span> <span data-ttu-id="5934c-200">Ha többet szeretne megtudni a Azure Stack hub méretezhetőségéről, tekintse meg a következő forrásokat:</span><span class="sxs-lookup"><span data-stu-id="5934c-200">To learn more about Azure Stack Hub's scalability, check out the following resources:</span></span>

- [<span data-ttu-id="5934c-201">Azure Stack hub kapacitásának tervezése – áttekintés</span><span class="sxs-lookup"><span data-stu-id="5934c-201">Capacity planning for Azure Stack Hub overview</span></span>](/azure-stack/operator/azure-stack-capacity-planning-overview)
- [<span data-ttu-id="5934c-202">További skálázási egység csomópontjainak hozzáadása Azure Stack hub-ban</span><span class="sxs-lookup"><span data-stu-id="5934c-202">Add additional scale unit nodes in Azure Stack Hub</span></span>](/azure-stack/operator/azure-stack-add-scale-node)

<span data-ttu-id="5934c-203">**Kubernetes-fürt (fürt szintje)**</span><span class="sxs-lookup"><span data-stu-id="5934c-203">**Kubernetes cluster (cluster level)**</span></span>

<span data-ttu-id="5934c-204">Maga a Kubernetes-fürt áll, és az Azure (stack) IaaS-összetevőkre épül, beleértve a számítási, tárolási és hálózati erőforrásokat.</span><span class="sxs-lookup"><span data-stu-id="5934c-204">The Kubernetes cluster itself consists of, and is built on top of Azure (Stack) IaaS components including compute, storage, and network resources.</span></span> <span data-ttu-id="5934c-205">A Kubernetes-megoldások fő-és munkavégző csomópontokat tartalmaznak, amelyek az Azure-ban (és Azure Stack hub-ban) virtuális gépekként vannak üzembe helyezve.</span><span class="sxs-lookup"><span data-stu-id="5934c-205">Kubernetes solutions involve master and worker nodes, which are deployed as VMs in Azure (and Azure Stack Hub).</span></span>

- <span data-ttu-id="5934c-206">A [vezérlési sík csomópontjai](/azure/aks/concepts-clusters-workloads#control-plane) (Master) biztosítják a legfontosabb Kubernetes szolgáltatásokat és az alkalmazások számítási feladatainak előkészítését.</span><span class="sxs-lookup"><span data-stu-id="5934c-206">[Control plane nodes](/azure/aks/concepts-clusters-workloads#control-plane) (master) provide the core Kubernetes services and orchestration of application workloads.</span></span>
- <span data-ttu-id="5934c-207">[Munkavégző csomópontok](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) (feldolgozó) futtatják az alkalmazás számítási feladatait.</span><span class="sxs-lookup"><span data-stu-id="5934c-207">[Worker nodes](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) (worker) run your application workloads.</span></span>

<span data-ttu-id="5934c-208">A virtuális gépek méretének kiválasztásakor a kezdeti üzembe helyezés több szempontot is figyelembe vesz:</span><span class="sxs-lookup"><span data-stu-id="5934c-208">When selecting VM sizes for the initial deployment, there are several considerations:</span></span>  

- <span data-ttu-id="5934c-209">**Költség** – a munkavégző csomópontok tervezésekor vegye figyelembe, hogy a virtuális gépen felmerülő teljes költség.</span><span class="sxs-lookup"><span data-stu-id="5934c-209">**Cost** - When planning your worker nodes, keep in mind the overall cost per VM you'll incur.</span></span> <span data-ttu-id="5934c-210">Ha például az alkalmazás számítási feladatának korlátozott erőforrásokra van szüksége, érdemes kisebb méretű virtuális gépeket telepítenie.</span><span class="sxs-lookup"><span data-stu-id="5934c-210">For example, if your application workloads require limited resources, you should plan to deploy smaller sized VMs.</span></span> <span data-ttu-id="5934c-211">Az Azure Stack hub (például az Azure) általában fogyasztási alapon kerül számlázásra, ezért a virtuális gépek megfelelő méretezése a Kubernetes-szerepkörökhöz elengedhetetlen a használati költségek optimalizálásához.</span><span class="sxs-lookup"><span data-stu-id="5934c-211">Azure Stack Hub, like Azure, is normally billed on a consumption basis, so appropriately sizing the VMs for Kubernetes roles is crucial to optimizing consumption costs.</span></span> 

- <span data-ttu-id="5934c-212">**Méretezhetőség** – a fürt méretezhetősége a fő-és munkavégző csomópontok számának és a feldolgozói csomópontok számának skálázásával, vagy további Node-készletek hozzáadásával érhető el (a mai Azure stack hub-on nem érhetők el).</span><span class="sxs-lookup"><span data-stu-id="5934c-212">**Scalability** - Scalability of the cluster is achieved by scaling in and out the number of master and worker nodes, or by adding additional node pools (not available on Azure Stack Hub today).</span></span> <span data-ttu-id="5934c-213">A fürt méretezése a teljesítményadatok alapján, a tároló-elemzések (Azure Monitor + Log Analytics) használatával végezhető el.</span><span class="sxs-lookup"><span data-stu-id="5934c-213">Scaling the cluster can be done based on performance data, collected using Container Insights (Azure Monitor + Log Analytics).</span></span> 

    <span data-ttu-id="5934c-214">Ha az alkalmazásnak több (vagy kevesebb) erőforrásra van szüksége, horizontálisan kibővítheti az aktuális csomópontokat (vagy a-ben) vízszintesen (1 és 50 csomópont között).</span><span class="sxs-lookup"><span data-stu-id="5934c-214">If your application needs more (or fewer) resources, you can scale out (or in) your current nodes horizontally (between 1 and 50 nodes).</span></span> <span data-ttu-id="5934c-215">Ha 50-nél több csomópontra van szüksége, hozzon létre egy további fürtöt egy külön előfizetésben.</span><span class="sxs-lookup"><span data-stu-id="5934c-215">If you need more than 50 nodes, you can create an additional cluster in a separate subscription.</span></span> <span data-ttu-id="5934c-216">A tényleges virtuális gépeket nem lehet függőlegesen átméretezni egy másik virtuálisgép-méretre a fürt újbóli üzembe helyezése nélkül.</span><span class="sxs-lookup"><span data-stu-id="5934c-216">You can't scale up the actual VMs vertically to another VM size without redeploying the cluster.</span></span>

    <span data-ttu-id="5934c-217">A skálázást manuálisan, a Kubernetes-fürt üzembe helyezéséhez használt AK Engine Helper VM használatával végezheti el.</span><span class="sxs-lookup"><span data-stu-id="5934c-217">Scaling is done manually using the AKS Engine helper VM that was used to deploy the Kubernetes cluster initially.</span></span> <span data-ttu-id="5934c-218">További információ: Kubernetes- [fürtök skálázása](https://github.com/Azure/aks-engine/blob/master/docs/topics/scale.md)</span><span class="sxs-lookup"><span data-stu-id="5934c-218">For more information, see [Scaling Kubernetes clusters](https://github.com/Azure/aks-engine/blob/master/docs/topics/scale.md)</span></span>

- <span data-ttu-id="5934c-219">**Kvóták** – vegye figyelembe azokat a [kvótákat](/azure-stack/operator/azure-stack-quota-types) , amelyeket az AK-beli központi telepítés tervezésekor konfigurált a Azure stack hubhoz.</span><span class="sxs-lookup"><span data-stu-id="5934c-219">**Quotas** - Consider the [quotas](/azure-stack/operator/azure-stack-quota-types) you've configured when planning out an AKS deployment on your Azure Stack Hub.</span></span> <span data-ttu-id="5934c-220">Győződjön meg arról, hogy minden [előfizetés](/azure-stack/operator/service-plan-offer-subscription-overview) rendelkezik a megfelelő csomagokkal és a beállított kvótákkal.</span><span class="sxs-lookup"><span data-stu-id="5934c-220">Make sure each [subscription](/azure-stack/operator/service-plan-offer-subscription-overview) has the proper plans and the quotas configured.</span></span> <span data-ttu-id="5934c-221">Az előfizetésnek el kell fogadnia a fürtökhöz szükséges számítási, tárolási és egyéb szolgáltatások mennyiségét.</span><span class="sxs-lookup"><span data-stu-id="5934c-221">The subscription will need to accommodate the amount of compute, storage, and other services needed for your clusters as they scale out.</span></span>

- <span data-ttu-id="5934c-222">**Alkalmazás-munkaterhelések** – tekintse meg a [fürtök és a számítási feladatok fogalmait](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) az Azure Kubernetes-Kubernetes alapvető fogalmait ismertető témakörben.</span><span class="sxs-lookup"><span data-stu-id="5934c-222">**Application workloads** - Refer to the [Clusters and workloads concepts](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) in the Kubernetes core concepts for Azure Kubernetes Service document.</span></span> <span data-ttu-id="5934c-223">Ez a cikk segítséget nyújt a megfelelő virtuálisgép-méret hatókörében az alkalmazás számítási és memóriabeli igényei alapján.</span><span class="sxs-lookup"><span data-stu-id="5934c-223">This article will help you scope the proper VM size based on the compute and memory needs of your application.</span></span>  

<span data-ttu-id="5934c-224">**Alkalmazás (alkalmazás szintje)**</span><span class="sxs-lookup"><span data-stu-id="5934c-224">**Application (application level)**</span></span>

<span data-ttu-id="5934c-225">Az alkalmazási rétegben a Kubernetes [horizontális Pod automéretezőt (hPa)](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/)használjuk.</span><span class="sxs-lookup"><span data-stu-id="5934c-225">On the application layer, we use Kubernetes [Horizontal Pod Autoscaler (HPA)](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/).</span></span> <span data-ttu-id="5934c-226">A HPA a különböző metrikák (például a CPU-kihasználtság) alapján növelheti vagy csökkentheti az üzemelő példányok számát (Pod/Container Instances).</span><span class="sxs-lookup"><span data-stu-id="5934c-226">HPA can increase or decrease the number of Replicas (Pod/Container Instances) in our deployment based on different metrics (like CPU utilization).</span></span>

<span data-ttu-id="5934c-227">Egy másik lehetőség a tároló-példányok függőleges méretezése.</span><span class="sxs-lookup"><span data-stu-id="5934c-227">Another option is to scale container instances vertically.</span></span> <span data-ttu-id="5934c-228">Ezt úgy teheti meg, hogy megváltoztatja a kért és elérhető CPU és memória mennyiségét egy adott telepítéshez.</span><span class="sxs-lookup"><span data-stu-id="5934c-228">This can be accomplished by changing the amount of CPU and Memory requested and available for a specific deployment.</span></span> <span data-ttu-id="5934c-229">További információkért lásd: [tárolók erőforrásainak kezelése](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/) a kubernetes.IO-on.</span><span class="sxs-lookup"><span data-stu-id="5934c-229">See [Managing Resources for Containers](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/) on kubernetes.io to learn more.</span></span>

## <a name="networking-and-connectivity-considerations"></a><span data-ttu-id="5934c-230">Hálózatkezelés és kapcsolódási megfontolások</span><span class="sxs-lookup"><span data-stu-id="5934c-230">Networking and connectivity considerations</span></span>

<span data-ttu-id="5934c-231">A Hálózatkezelés és a kapcsolat is befolyásolja az Azure Stack hub Kubernetes korábban említett három réteget.</span><span class="sxs-lookup"><span data-stu-id="5934c-231">Networking and connectivity also affect the three layers mentioned previously for Kubernetes on Azure Stack Hub.</span></span> <span data-ttu-id="5934c-232">A következő táblázat a rétegek és a bennük található szolgáltatásokat tartalmazza:</span><span class="sxs-lookup"><span data-stu-id="5934c-232">The following table shows the layers and which services they contain:</span></span>

| <span data-ttu-id="5934c-233">Réteg</span><span class="sxs-lookup"><span data-stu-id="5934c-233">Layer</span></span> | <span data-ttu-id="5934c-234">Befolyásolja</span><span class="sxs-lookup"><span data-stu-id="5934c-234">Affects</span></span> | <span data-ttu-id="5934c-235">Mi?</span><span class="sxs-lookup"><span data-stu-id="5934c-235">What?</span></span> |
| --- | --- | ---
| <span data-ttu-id="5934c-236">Alkalmazás</span><span class="sxs-lookup"><span data-stu-id="5934c-236">Application</span></span> | <span data-ttu-id="5934c-237">Alkalmazás</span><span class="sxs-lookup"><span data-stu-id="5934c-237">Application</span></span> | <span data-ttu-id="5934c-238">Hogyan érhető el az alkalmazás?</span><span class="sxs-lookup"><span data-stu-id="5934c-238">How is the application accessible?</span></span> <span data-ttu-id="5934c-239">Elérhető lesz az Internet?</span><span class="sxs-lookup"><span data-stu-id="5934c-239">Will it be exposed to the Internet?</span></span> |
| <span data-ttu-id="5934c-240">Fürt</span><span class="sxs-lookup"><span data-stu-id="5934c-240">Cluster</span></span> | <span data-ttu-id="5934c-241">Kubernetes-fürt</span><span class="sxs-lookup"><span data-stu-id="5934c-241">Kubernetes cluster</span></span> | <span data-ttu-id="5934c-242">Kubernetes API, KABAi motor VM, tároló lemezképek húzása (kimenő), figyelési adatok küldése és telemetria (kimenő forgalom)</span><span class="sxs-lookup"><span data-stu-id="5934c-242">Kubernetes API, AKS Engine VM, Pulling container images (egress), Sending monitoring data and telemetry (egress)</span></span> |
| <span data-ttu-id="5934c-243">Infrastruktúra</span><span class="sxs-lookup"><span data-stu-id="5934c-243">Infrastructure</span></span> | <span data-ttu-id="5934c-244">Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="5934c-244">Azure Stack Hub</span></span> | <span data-ttu-id="5934c-245">Az Azure Stack hub felügyeleti végpontok, például a portál és a Azure Resource Manager végpontok hozzáférhetősége.</span><span class="sxs-lookup"><span data-stu-id="5934c-245">Accessibility of the Azure Stack Hub management endpoints like the portal and Azure Resource Manager endpoints.</span></span> |

<span data-ttu-id="5934c-246">**Alkalmazás**</span><span class="sxs-lookup"><span data-stu-id="5934c-246">**Application**</span></span>

<span data-ttu-id="5934c-247">Az alkalmazási réteg esetében a legfontosabb szempont, hogy az alkalmazás elérhető-e az internetről.</span><span class="sxs-lookup"><span data-stu-id="5934c-247">For the application layer, the most important consideration is whether the application is exposed and accessible from the Internet.</span></span> <span data-ttu-id="5934c-248">A Kubernetes perspektívában az Internet kisegítő lehetőségek az üzemelő példányok vagy a hüvelyek Kubernetes szolgáltatással vagy bejövő vezérlővel való kihelyezését jelentik.</span><span class="sxs-lookup"><span data-stu-id="5934c-248">From a Kubernetes perspective, Internet accessibility means exposing a deployment or pod using a Kubernetes Service or an Ingress Controller.</span></span>

> [!NOTE]
> <span data-ttu-id="5934c-249">Azt javasoljuk, hogy a beáramlási vezérlők használatával tegye közzé a Kubernetes szolgáltatásait, mivel a Azure Stack hub-beli előtér nyilvános IP-címeinek száma legfeljebb 5.</span><span class="sxs-lookup"><span data-stu-id="5934c-249">We recommend the use of Ingress controllers to expose Kubernetes Services as the number of Frontend public IPs on Azure Stack Hub is limited to 5.</span></span> <span data-ttu-id="5934c-250">Ez a kialakítás azt is korlátozza, hogy a Kubernetes szolgáltatások száma (a terheléselosztó típussal együtt) 5, ami túl kicsi lesz a sok üzemelő példány esetében.</span><span class="sxs-lookup"><span data-stu-id="5934c-250">This design also limits the number of Kubernetes Services (with the type LoadBalancer) to 5, which will be too small for many deployments.</span></span> <span data-ttu-id="5934c-251">További információért nyissa meg az [AK-motor dokumentációját](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#limited-number-of-frontend-public-ips) .</span><span class="sxs-lookup"><span data-stu-id="5934c-251">Go to the [AKS Engine documentation](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#limited-number-of-frontend-public-ips) to learn more.</span></span>

<span data-ttu-id="5934c-252">A nyilvános IP-címet használó alkalmazások Load Balancer vagy egy bejövő vezérlőn keresztül nem nessecarily azt jelenti, hogy az alkalmazás most már elérhető az interneten keresztül.</span><span class="sxs-lookup"><span data-stu-id="5934c-252">Exposing an application using a public IP via a Load Balancer or an Ingress Controller doesn't nessecarily mean that the application is now accessible via the Internet.</span></span> <span data-ttu-id="5934c-253">Lehetséges, hogy Azure Stack hub olyan nyilvános IP-címmel rendelkezik, amely csak a helyi intraneten látható – nem minden nyilvános IP-cím valóban internetre irányul.</span><span class="sxs-lookup"><span data-stu-id="5934c-253">It's possible for Azure Stack Hub to have a public IP address that is only visible on the local intranet - not all public IPs are truly Internet-facing.</span></span>

<span data-ttu-id="5934c-254">Az előző blokk az alkalmazás felé irányuló forgalmat veszi át.</span><span class="sxs-lookup"><span data-stu-id="5934c-254">The previous block considers ingress traffic to the application.</span></span> <span data-ttu-id="5934c-255">Egy másik témakör, amelyet a sikeres Kubernetes-telepítésnek figyelembe kell vennie kimenő/kimenő forgalom.</span><span class="sxs-lookup"><span data-stu-id="5934c-255">Another topic that must be considered for a successful Kubernetes deployment is outbound/egress traffic.</span></span> <span data-ttu-id="5934c-256">Íme néhány olyan használati eset, amely a kimenő forgalmat igényli:</span><span class="sxs-lookup"><span data-stu-id="5934c-256">Here are a few use cases that require egress traffic:</span></span>

- <span data-ttu-id="5934c-257">DockerHub vagy Azure Container Registry tárolt tároló-lemezképek húzása</span><span class="sxs-lookup"><span data-stu-id="5934c-257">Pulling Container Images stored on DockerHub or Azure Container Registry</span></span>
- <span data-ttu-id="5934c-258">Helm-diagramok beolvasása</span><span class="sxs-lookup"><span data-stu-id="5934c-258">Retrieving Helm Charts</span></span>
- <span data-ttu-id="5934c-259">AdatApplication Insights-adatkibocsátás (vagy más figyelési adatmennyiség)</span><span class="sxs-lookup"><span data-stu-id="5934c-259">Emitting Application Insights data (or other monitoring data)</span></span>

<span data-ttu-id="5934c-260">Előfordulhat, hogy egyes vállalati környezetek _transzparens_ vagy _nem transzparens_ proxykiszolgálók használatát igénylik.</span><span class="sxs-lookup"><span data-stu-id="5934c-260">Some enterprise environments might require the use of _transparent_ or _non-transparent_ proxy servers.</span></span> <span data-ttu-id="5934c-261">Ezeknek a kiszolgálóknak speciális konfigurációra van szükségük a fürt különböző összetevőin.</span><span class="sxs-lookup"><span data-stu-id="5934c-261">These servers require specific configuration on various components of our cluster.</span></span> <span data-ttu-id="5934c-262">Az AK-motor dokumentációja a hálózati proxyk befogadásának részletes ismertetését tartalmazza.</span><span class="sxs-lookup"><span data-stu-id="5934c-262">The AKS Engine documentation contains various details on how to accommodate network proxies.</span></span> <span data-ttu-id="5934c-263">További részletek: [AK-motor és proxykiszolgáló](https://github.com/Azure/aks-engine/blob/master/docs/topics/proxy-servers.md)</span><span class="sxs-lookup"><span data-stu-id="5934c-263">For more details, see [AKS Engine and proxy servers](https://github.com/Azure/aks-engine/blob/master/docs/topics/proxy-servers.md)</span></span>

<span data-ttu-id="5934c-264">Végül a fürt közötti forgalomnak Azure Stack hub-példányok között kell haladnia.</span><span class="sxs-lookup"><span data-stu-id="5934c-264">Lastly, cross-cluster traffic must flow between Azure Stack Hub instances.</span></span> <span data-ttu-id="5934c-265">A minta üzembe helyezése különálló, Azure Stack hub-példányokon futó Kubernetes-fürtökből áll.</span><span class="sxs-lookup"><span data-stu-id="5934c-265">The sample deployment consists of individual Kubernetes clusters running on individual Azure Stack Hub instances.</span></span> <span data-ttu-id="5934c-266">A közöttük lévő forgalom, például a két adatbázis közötti replikációs forgalom "külső forgalom".</span><span class="sxs-lookup"><span data-stu-id="5934c-266">Traffic between them, such as the replication traffic between two databases, is "external traffic".</span></span> <span data-ttu-id="5934c-267">A külső forgalmat helyek közötti VPN-vagy Azure Stack hub nyilvános IP-címekről kell irányítani a Kubernetes két Azure Stack hub-példányon való összekapcsolásához:</span><span class="sxs-lookup"><span data-stu-id="5934c-267">External traffic must be routed through either a Site-to-Site VPN or Azure Stack Hub Public IP addresses to connect Kubernetes on two Azure Stack Hub instances:</span></span>

![csomópontok közötti és belüli forgalom](media/pattern-highly-available-kubernetes/aks-inter-and-intra-cluster-traffic.png)

<span data-ttu-id="5934c-269">**Csoport**</span><span class="sxs-lookup"><span data-stu-id="5934c-269">**Cluster**</span></span>  

<span data-ttu-id="5934c-270">A Kubernetes-fürtnek nem feltétlenül kell elérhetőnek lennie az interneten keresztül.</span><span class="sxs-lookup"><span data-stu-id="5934c-270">The Kubernetes cluster doesn't necessarily need to be accessible via the Internet.</span></span> <span data-ttu-id="5934c-271">Az érintett rész a fürt üzemeltetéséhez használt Kubernetes API, például a használatával `kubectl` .</span><span class="sxs-lookup"><span data-stu-id="5934c-271">The relevant part is the Kubernetes API used to operate a cluster, for example, using `kubectl`.</span></span> <span data-ttu-id="5934c-272">A Kubernetes API-végpontnak elérhetőnek kell lennie mindenki számára, aki üzemelteti a fürtöt, vagy alkalmazásokat és szolgáltatásokat helyez üzembe.</span><span class="sxs-lookup"><span data-stu-id="5934c-272">The Kubernetes API endpoint must be accessible to everyone who operates the cluster or deploys applications and services on top of it.</span></span> <span data-ttu-id="5934c-273">Ezt a témakört részletesebben az [üzembe helyezési (CI/CD) szempontokat](#deployment-cicd-considerations) ismertető szakasz DevOps tárgyalja.</span><span class="sxs-lookup"><span data-stu-id="5934c-273">This topic is covered in more detail from a DevOps-perspective in the [Deployment (CI/CD) considerations](#deployment-cicd-considerations) section below.</span></span>

<span data-ttu-id="5934c-274">A fürt szintjén a kimenő forgalomról is van néhány szempont:</span><span class="sxs-lookup"><span data-stu-id="5934c-274">On the cluster level, there are also a few considerations around egress-traffic:</span></span>

- <span data-ttu-id="5934c-275">Csomópont-frissítések (Ubuntu)</span><span class="sxs-lookup"><span data-stu-id="5934c-275">Node updates (for Ubuntu)</span></span>
- <span data-ttu-id="5934c-276">Figyelési adatszolgáltatások (az Azure LogAnalytics-ben elküldve)</span><span class="sxs-lookup"><span data-stu-id="5934c-276">Monitoring data (sent to Azure LogAnalytics)</span></span>
- <span data-ttu-id="5934c-277">Egyéb, kimenő forgalmat igénylő ügynökök (az egyes telepítők környezete esetében)</span><span class="sxs-lookup"><span data-stu-id="5934c-277">Other agents requiring outbound traffic (specific to each deployer's environment)</span></span>

<span data-ttu-id="5934c-278">Mielőtt üzembe helyezi a Kubernetes-fürtöt az AK Engine használatával, tervezze meg a végső hálózatkezelési tervet.</span><span class="sxs-lookup"><span data-stu-id="5934c-278">Before you deploy your Kubernetes cluster using AKS Engine, plan for the final networking design.</span></span> <span data-ttu-id="5934c-279">A dedikált Virtual Network létrehozása helyett hatékonyabb lehet a fürt üzembe helyezése egy meglévő hálózatban.</span><span class="sxs-lookup"><span data-stu-id="5934c-279">Instead of creating a dedicated Virtual Network, it may be more efficient to deploy a cluster into an existing network.</span></span> <span data-ttu-id="5934c-280">Használhat például egy meglévő, a Azure Stack hub-környezetben már konfigurált, két hálózat közötti pont-pont típusú VPN-kapcsolat használatát.</span><span class="sxs-lookup"><span data-stu-id="5934c-280">For example, you might leverage an existing Site-to-Site VPN connection already configured in your Azure Stack Hub environment.</span></span>

<span data-ttu-id="5934c-281">**Infrastruktúra**</span><span class="sxs-lookup"><span data-stu-id="5934c-281">**Infrastructure**</span></span>  

<span data-ttu-id="5934c-282">Az infrastruktúra az Azure Stack hub felügyeleti végpontok elérésére utal.</span><span class="sxs-lookup"><span data-stu-id="5934c-282">Infrastructure refers to accessing the Azure Stack Hub management endpoints.</span></span> <span data-ttu-id="5934c-283">A végpontok közé tartoznak a bérlői és a felügyeleti portálok, valamint a Azure Resource Manager felügyeleti és bérlői végpontok.</span><span class="sxs-lookup"><span data-stu-id="5934c-283">Endpoints include the tenant and admin portals, and the Azure Resource Manager admin and tenant endpoints.</span></span> <span data-ttu-id="5934c-284">Ezek a végpontok a Azure Stack hub és az alapvető szolgáltatásainak üzemeltetéséhez szükségesek.</span><span class="sxs-lookup"><span data-stu-id="5934c-284">These endpoints are required to operate Azure Stack Hub and its core services.</span></span>

## <a name="data-and-storage-considerations"></a><span data-ttu-id="5934c-285">Az adatkezeléssel és a tárolással kapcsolatos megfontolások</span><span class="sxs-lookup"><span data-stu-id="5934c-285">Data and storage considerations</span></span>

<span data-ttu-id="5934c-286">Az alkalmazás két példánya lesz üzembe helyezve két különálló Kubernetes-fürtön két Azure Stack hub-példányon.</span><span class="sxs-lookup"><span data-stu-id="5934c-286">Two instances of our application will be deployed, on two individual Kubernetes clusters, across two Azure Stack Hub instances.</span></span> <span data-ttu-id="5934c-287">Ennek a kialakításnak meg kell fontolnia, hogyan replikálja és szinkronizálja az adatokat közöttük.</span><span class="sxs-lookup"><span data-stu-id="5934c-287">This design will require us to consider how to replicate and synchronize data between them.</span></span>

<span data-ttu-id="5934c-288">Az Azure-ban beépített képességgel rendelkezünk a tárterület több régióban és zónán belüli replikálásához a felhőben.</span><span class="sxs-lookup"><span data-stu-id="5934c-288">With Azure, we have the built-in capability to replicate storage across multiple regions and zones within the cloud.</span></span> <span data-ttu-id="5934c-289">Jelenleg Azure Stack hub-ban nincsenek natív módon replikálni a tárterületet két különböző Azure Stack hub-példány között – két független felhőt alkotnak, amelyek nincsenek átfogó módon kezelve a készletként.</span><span class="sxs-lookup"><span data-stu-id="5934c-289">Currently with Azure Stack Hub there are no native ways to replicate storage across two different Azure Stack Hub instances - they form two independent clouds with no overarching way to manage them as a set.</span></span> <span data-ttu-id="5934c-290">Az Azure Stack hub-on futó alkalmazások rugalmasságának megtervezése arra kényszeríti, hogy az alkalmazás megtervezésében és üzembe helyezésében vegye figyelembe ezt a függetlenséget.</span><span class="sxs-lookup"><span data-stu-id="5934c-290">Planning for resiliency of applications running across Azure Stack Hub forces you to consider this independence in your application design and deployments.</span></span>

<span data-ttu-id="5934c-291">A legtöbb esetben a tárolók replikálására nem lesz szükség az AK-on üzembe helyezett rugalmas és nagy rendelkezésre állású alkalmazásokhoz.</span><span class="sxs-lookup"><span data-stu-id="5934c-291">In most cases, storage replication won't be necessary for a resilient and highly available application deployed on AKS.</span></span> <span data-ttu-id="5934c-292">Az alkalmazás megtervezése során azonban Azure Stack hub-példányon kell megfontolnia a független tárterületet.</span><span class="sxs-lookup"><span data-stu-id="5934c-292">But you should consider independent storage per Azure Stack Hub instance in your application design.</span></span> <span data-ttu-id="5934c-293">Ha ez a kialakítás a megoldás Azure Stack hub-on való üzembe helyezésére vonatkozó aggályos vagy országúti blokk, a Microsoft partnereinek lehetséges megoldásai vannak, amelyek tárolási mellékleteket biztosítanak.</span><span class="sxs-lookup"><span data-stu-id="5934c-293">If this design is a concern or road block to deploying the solution on Azure Stack Hub, there are possible solutions from Microsoft Partners that provide storage attachments.</span></span> <span data-ttu-id="5934c-294">A tárolási mellékletek tárolási replikációs megoldást biztosítanak több Azure Stack hub és az Azure között.</span><span class="sxs-lookup"><span data-stu-id="5934c-294">Storage attachments provide a storage replication solution across multiple Azure Stack Hubs and Azure.</span></span> <span data-ttu-id="5934c-295">További információ: [partneri megoldások](#partner-solutions).</span><span class="sxs-lookup"><span data-stu-id="5934c-295">For more information, see the [Partner solutions](#partner-solutions).</span></span>

<span data-ttu-id="5934c-296">Architektúránk esetében a következő rétegeket vették figyelembe:</span><span class="sxs-lookup"><span data-stu-id="5934c-296">In our architecture, these layers were considered:</span></span>

<span data-ttu-id="5934c-297">**Konfigurálás**</span><span class="sxs-lookup"><span data-stu-id="5934c-297">**Configuration**</span></span>

<span data-ttu-id="5934c-298">A konfiguráció magában foglalja az Azure Stack hub, az AK motor és a Kubernetes-fürt konfigurációját.</span><span class="sxs-lookup"><span data-stu-id="5934c-298">Configuration includes the configuration of Azure Stack Hub, AKS Engine, and the Kubernetes cluster itself.</span></span> <span data-ttu-id="5934c-299">A konfigurációnak a lehető legszélesebb körűen kell lennie, és a git-alapú verziókövető rendszer, például az Azure DevOps vagy a GitHub esetében az infrastruktúra-kódként kell tárolnia.</span><span class="sxs-lookup"><span data-stu-id="5934c-299">The configuration should be automated as much as possible, and stored as Infrastructure-as-Code in a Git-based version control system like Azure DevOps or GitHub.</span></span> <span data-ttu-id="5934c-300">Ezeket a beállításokat nem lehet egyszerűen szinkronizálni több üzemelő példány között.</span><span class="sxs-lookup"><span data-stu-id="5934c-300">These settings cannot easily be synchronized across multiple deployments.</span></span> <span data-ttu-id="5934c-301">Ezért javasoljuk, hogy a konfigurációt kívülről és a DevOps folyamat használatával tárolja és alkalmazza.</span><span class="sxs-lookup"><span data-stu-id="5934c-301">Therefore we recommend storing and applying configuration from the outside, and using DevOps pipeline.</span></span>

<span data-ttu-id="5934c-302">**Alkalmazás**</span><span class="sxs-lookup"><span data-stu-id="5934c-302">**Application**</span></span>

<span data-ttu-id="5934c-303">Az alkalmazást git-alapú tárházban kell tárolni.</span><span class="sxs-lookup"><span data-stu-id="5934c-303">The application should be stored in a Git-based repository.</span></span> <span data-ttu-id="5934c-304">Ha új központi telepítésre kerül sor, az alkalmazás változásai vagy a vész-helyreállítási folyamat egyszerűen üzembe helyezhető az Azure-folyamatok használatával.</span><span class="sxs-lookup"><span data-stu-id="5934c-304">Whenever there's a new deployment, changes to the application, or disaster recovery, it can be easily deployed using Azure Pipelines.</span></span>

<span data-ttu-id="5934c-305">**Adatok**</span><span class="sxs-lookup"><span data-stu-id="5934c-305">**Data**</span></span>

<span data-ttu-id="5934c-306">Az alkalmazások többsége a legfontosabb szempont.</span><span class="sxs-lookup"><span data-stu-id="5934c-306">Data is the most important consideration in most application designs.</span></span> <span data-ttu-id="5934c-307">Az alkalmazásadatok szinkronban kell maradnak az alkalmazás különböző példányai között.</span><span class="sxs-lookup"><span data-stu-id="5934c-307">Application data must stay in sync between the different instances of the application.</span></span> <span data-ttu-id="5934c-308">Az adatvesztés miatt a biztonsági mentési és vész-helyreállítási stratégia is szükséges.</span><span class="sxs-lookup"><span data-stu-id="5934c-308">Data also needs a backup and disaster recovery strategy if there's an outage.</span></span>

<span data-ttu-id="5934c-309">Ennek a kialakításnak a megvalósítása nagy mértékben függ a technológiai lehetőségektől.</span><span class="sxs-lookup"><span data-stu-id="5934c-309">Achieving this design depends heavily on technology choices.</span></span> <span data-ttu-id="5934c-310">Íme néhány példa arra, hogyan implementálhat egy adatbázist a Azure Stack hub-ban található, magasan elérhető módon:</span><span class="sxs-lookup"><span data-stu-id="5934c-310">Here are some solution examples for implementing a database in a highly available fashion on Azure Stack Hub:</span></span>

- [<span data-ttu-id="5934c-311">SQL Server 2016 rendelkezésre állási csoport üzembe helyezése az Azure-ban és Azure Stack hub-ban</span><span class="sxs-lookup"><span data-stu-id="5934c-311">Deploy a SQL Server 2016 availability group to Azure and Azure Stack Hub</span></span>](/azure-stack/hybrid/solution-deployment-guide-sql-ha)
- [<span data-ttu-id="5934c-312">Magasan elérhető MongoDB-megoldás üzembe helyezése az Azure-ban és Azure Stack hub</span><span class="sxs-lookup"><span data-stu-id="5934c-312">Deploy a highly available MongoDB solution to Azure and Azure Stack Hub</span></span>](/azure-stack/hybrid/solution-deployment-guide-mongodb-ha)

<span data-ttu-id="5934c-313">A több helyen tárolt adatkezelési megfontolások még összetettebbek a nagyfokú rendelkezésre állású és rugalmas megoldás érdekében.</span><span class="sxs-lookup"><span data-stu-id="5934c-313">Considerations when working with data across multiple locations is an even more complex consideration for a highly available and resilient solution.</span></span> <span data-ttu-id="5934c-314">Megfontolandó szempontok:</span><span class="sxs-lookup"><span data-stu-id="5934c-314">Consider:</span></span>

- <span data-ttu-id="5934c-315">Azure Stack hubok közötti késés és hálózati kapcsolat.</span><span class="sxs-lookup"><span data-stu-id="5934c-315">Latency and network connectivity between Azure Stack Hubs.</span></span>
- <span data-ttu-id="5934c-316">A szolgáltatások és engedélyek identitásának rendelkezésre állása.</span><span class="sxs-lookup"><span data-stu-id="5934c-316">Availability of identities for services and permissions.</span></span> <span data-ttu-id="5934c-317">Minden Azure Stack hub-példány egy külső címtárral integrálódik.</span><span class="sxs-lookup"><span data-stu-id="5934c-317">Each Azure Stack Hub instance integrates with an external directory.</span></span> <span data-ttu-id="5934c-318">Az üzembe helyezés során a Azure Active Directory (Azure AD) vagy a Active Directory összevonási szolgáltatások (AD FS) (ADFS) használatát választja.</span><span class="sxs-lookup"><span data-stu-id="5934c-318">During deployment, you choose to use either Azure Active Directory (Azure AD) or Active Directory Federation Services (ADFS).</span></span> <span data-ttu-id="5934c-319">Ilyen esetben egyetlen identitást használhat, amely több független Azure Stack hub-példánnyal is képes együttműködni.</span><span class="sxs-lookup"><span data-stu-id="5934c-319">As such, there's potential to use a single identity that can interact with multiple independent Azure Stack Hub instances.</span></span>

## <a name="business-continuity-and-disaster-recovery"></a><span data-ttu-id="5934c-320">Folyamatos üzletmenet és vészhelyreállítás</span><span class="sxs-lookup"><span data-stu-id="5934c-320">Business continuity and disaster recovery</span></span>

<span data-ttu-id="5934c-321">Az üzletmenet-folytonosság és a vész-helyreállítás (BCDR) fontos témakör a Azure Stack hub és az Azure között.</span><span class="sxs-lookup"><span data-stu-id="5934c-321">Business continuity and disaster recovery (BCDR) is an important topic in both Azure Stack Hub and Azure.</span></span> <span data-ttu-id="5934c-322">A fő különbség az, hogy Azure Stack központban az operátornak a teljes BCDR folyamatot kell kezelnie.</span><span class="sxs-lookup"><span data-stu-id="5934c-322">The main difference is that in Azure Stack Hub, the operator must manage the whole BCDR process.</span></span> <span data-ttu-id="5934c-323">Az Azure-ban a BCDR egyes részeit a Microsoft automatikusan kezeli.</span><span class="sxs-lookup"><span data-stu-id="5934c-323">In Azure, parts of BCDR are automatically managed by Microsoft.</span></span>

<span data-ttu-id="5934c-324">A BCDR az előző szakaszban említett, az [adatkezelési és a tárolási szempontokat](#data-and-storage-considerations)is érinti:</span><span class="sxs-lookup"><span data-stu-id="5934c-324">BCDR affects the same areas mentioned in the previous section [Data and storage considerations](#data-and-storage-considerations):</span></span>

- <span data-ttu-id="5934c-325">Infrastruktúra/konfiguráció</span><span class="sxs-lookup"><span data-stu-id="5934c-325">Infrastructure / Configuration</span></span>
- <span data-ttu-id="5934c-326">Alkalmazás rendelkezésre állása</span><span class="sxs-lookup"><span data-stu-id="5934c-326">Application Availability</span></span>
- <span data-ttu-id="5934c-327">Alkalmazásadatok</span><span class="sxs-lookup"><span data-stu-id="5934c-327">Application Data</span></span>

<span data-ttu-id="5934c-328">Az előző szakaszban említettek szerint ezek a területek a Azure Stack hub-kezelő feladata, és a szervezetek között változhatnak.</span><span class="sxs-lookup"><span data-stu-id="5934c-328">And as mentioned in the previous section, these areas are the responsibility of the Azure Stack Hub operator and can vary between organizations.</span></span> <span data-ttu-id="5934c-329">Tervezze meg a BCDR az elérhető eszközök és folyamatok alapján.</span><span class="sxs-lookup"><span data-stu-id="5934c-329">Plan BCDR according to your available tools and processes.</span></span>

<span data-ttu-id="5934c-330">**Infrastruktúra és konfiguráció**</span><span class="sxs-lookup"><span data-stu-id="5934c-330">**Infrastructure and configuration**</span></span>

<span data-ttu-id="5934c-331">Ez a szakasz az Azure Stack hub fizikai és logikai infrastruktúráját és konfigurációját ismerteti.</span><span class="sxs-lookup"><span data-stu-id="5934c-331">This section covers the physical and logical infrastructure and the configuration of Azure Stack Hub.</span></span> <span data-ttu-id="5934c-332">A rendszergazda és a bérlői terek műveleteit fedi le.</span><span class="sxs-lookup"><span data-stu-id="5934c-332">It covers actions in the admin and the tenant spaces.</span></span>

<span data-ttu-id="5934c-333">Az Azure Stack hub operátor (vagy a rendszergazda) felelős az Azure Stack hub-példányok fenntartásáért.</span><span class="sxs-lookup"><span data-stu-id="5934c-333">The Azure Stack Hub operator (or administrator) is responsible for maintenance of the Azure Stack Hub instances.</span></span> <span data-ttu-id="5934c-334">Olyan összetevőket is beleértve, mint például a hálózat, a tárolás, az identitás és más, a jelen cikk hatálya alá eső témakörök.</span><span class="sxs-lookup"><span data-stu-id="5934c-334">Including components such as the network, storage, identity, and other topics that are outside the scope of this article.</span></span> <span data-ttu-id="5934c-335">Ha többet szeretne megtudni az Azure Stack hub-műveletek jellemzőiről, tekintse meg a következő forrásokat:</span><span class="sxs-lookup"><span data-stu-id="5934c-335">To learn more about the specifics of Azure Stack Hub operations, see the following resources:</span></span>

- [<span data-ttu-id="5934c-336">Azure Stack hub adatainak helyreállítása a Infrastructure Backup szolgáltatással</span><span class="sxs-lookup"><span data-stu-id="5934c-336">Recover data in Azure Stack Hub with the Infrastructure Backup Service</span></span>](/azure-stack/operator/azure-stack-backup-infrastructure-backup)
- [<span data-ttu-id="5934c-337">Biztonsági mentés engedélyezése Azure Stack hub számára a felügyeleti portálról</span><span class="sxs-lookup"><span data-stu-id="5934c-337">Enable backup for Azure Stack Hub from the administrator portal</span></span>](/azure-stack/operator/azure-stack-backup-enable-backup-console)
- [<span data-ttu-id="5934c-338">Helyreállítás végzetes adatvesztés esetén</span><span class="sxs-lookup"><span data-stu-id="5934c-338">Recover from catastrophic data loss</span></span>](/azure-stack/operator/azure-stack-backup-recover-data)
- [<span data-ttu-id="5934c-339">Infrastructure Backup Service – ajánlott eljárások</span><span class="sxs-lookup"><span data-stu-id="5934c-339">Infrastructure Backup Service best practices</span></span>](/azure-stack/operator/azure-stack-backup-best-practices)

<span data-ttu-id="5934c-340">Azure Stack hub az a platform és háló, amelyen a Kubernetes-alkalmazásokat telepíteni fogja.</span><span class="sxs-lookup"><span data-stu-id="5934c-340">Azure Stack Hub is the platform and fabric on which Kubernetes applications will be deployed.</span></span> <span data-ttu-id="5934c-341">A Kubernetes alkalmazás tulajdonosa a Azure Stack hub felhasználója lesz, és hozzáférést biztosít a megoldáshoz szükséges alkalmazás-infrastruktúra telepítéséhez.</span><span class="sxs-lookup"><span data-stu-id="5934c-341">The application owner for the Kubernetes application will be a user of Azure Stack Hub, with access granted to deploy the application infrastructure needed for the solution.</span></span> <span data-ttu-id="5934c-342">Az alkalmazás-infrastruktúra ebben az esetben a Kubernetes-fürtöt jelenti, amely az AK motorral és a környező szolgáltatásokkal van üzembe helyezve.</span><span class="sxs-lookup"><span data-stu-id="5934c-342">Application infrastructure in this case means the Kubernetes cluster, deployed using AKS Engine, and the surrounding services.</span></span> <span data-ttu-id="5934c-343">Ezek az összetevők Azure Stack hubhoz lesznek telepítve, amelyet egy Azure Stack hub-ajánlat korlátoz.</span><span class="sxs-lookup"><span data-stu-id="5934c-343">These components will be deployed into Azure Stack Hub, constrained by an Azure Stack Hub offer.</span></span> <span data-ttu-id="5934c-344">Győződjön meg arról, hogy a Kubernetes alkalmazás tulajdonosa által elfogadott ajánlat elegendő kapacitással rendelkezik (Azure Stack hub-kvótákban kifejezve) a teljes megoldás üzembe helyezéséhez.</span><span class="sxs-lookup"><span data-stu-id="5934c-344">Make sure the offer accepted by the Kubernetes application owner has sufficient capacity (expressed in Azure Stack Hub quotas) to deploy the entire solution.</span></span> <span data-ttu-id="5934c-345">Ahogy azt az előző szakaszban is javasolta, az alkalmazás központi telepítésének automatizáltnak kell lennie az infrastruktúra-kód és az üzembe helyezési folyamatok (például az Azure DevOps Azure-folyamatok) használatával.</span><span class="sxs-lookup"><span data-stu-id="5934c-345">As recommended in the previous section, the application deployment should be automated using Infrastructure-as-Code and deployment pipelines like Azure DevOps Azure Pipelines.</span></span>

<span data-ttu-id="5934c-346">Az Azure Stack hub-ajánlatokkal és-kvótákkal kapcsolatos további információkért lásd: [Azure stack hub-szolgáltatások, csomagok, ajánlatok és előfizetések áttekintése](/azure-stack/operator/service-plan-offer-subscription-overview)</span><span class="sxs-lookup"><span data-stu-id="5934c-346">For more information on Azure Stack Hub offers and quotas, see [Azure Stack Hub services, plans, offers, and subscriptions overview](/azure-stack/operator/service-plan-offer-subscription-overview)</span></span>

<span data-ttu-id="5934c-347">Fontos, hogy biztonságosan mentse és tárolja az AK-motor konfigurációját, beleértve a kimeneteit is.</span><span class="sxs-lookup"><span data-stu-id="5934c-347">It's important to securely save and store the AKS Engine configuration including its outputs.</span></span> <span data-ttu-id="5934c-348">Ezek a fájlok a Kubernetes-fürt eléréséhez használt bizalmas információkat tartalmaznak, ezért védeni kell őket a nem rendszergazdák számára.</span><span class="sxs-lookup"><span data-stu-id="5934c-348">These files contain confidential information used to access the Kubernetes cluster, so it must be protected from being exposed to non-administrators.</span></span>

<span data-ttu-id="5934c-349">**Alkalmazás rendelkezésre állása**</span><span class="sxs-lookup"><span data-stu-id="5934c-349">**Application availability**</span></span>

<span data-ttu-id="5934c-350">Az alkalmazásnak nem szabad felhasználnia egy telepített példány biztonsági mentését.</span><span class="sxs-lookup"><span data-stu-id="5934c-350">The application shouldn't rely on backups of a deployed instance.</span></span> <span data-ttu-id="5934c-351">Általános gyakorlatként telepítse újra az alkalmazást az infrastruktúra-programkódok szerinti mintázatok után.</span><span class="sxs-lookup"><span data-stu-id="5934c-351">As a standard practice, redeploy the application completely following Infrastructure-as-Code patterns.</span></span> <span data-ttu-id="5934c-352">Például telepítse újra az Azure DevOps Azure-folyamatokat.</span><span class="sxs-lookup"><span data-stu-id="5934c-352">For example, redeploy using Azure DevOps Azure Pipelines.</span></span> <span data-ttu-id="5934c-353">A BCDR eljárásnak magában kell foglalnia az alkalmazás újratelepítését ugyanarra vagy egy másik Kubernetes-fürtre.</span><span class="sxs-lookup"><span data-stu-id="5934c-353">The BCDR procedure should involve the redeployment of the application to the same or another Kubernetes cluster.</span></span>

<span data-ttu-id="5934c-354">**Alkalmazásadatok**</span><span class="sxs-lookup"><span data-stu-id="5934c-354">**Application data**</span></span>

<span data-ttu-id="5934c-355">Az alkalmazásadatok az adatvesztés minimalizálásának kritikus részét képezik.</span><span class="sxs-lookup"><span data-stu-id="5934c-355">Application data is the critical part to minimize data loss.</span></span> <span data-ttu-id="5934c-356">Az előző szakaszban ismertetjük az alkalmazás két (vagy több) példánya közötti replikálási és szinkronizálási technikákat.</span><span class="sxs-lookup"><span data-stu-id="5934c-356">In the previous section, techniques to replicate and synchronize data between two (or more) instances of the application were described.</span></span> <span data-ttu-id="5934c-357">Az adatok tárolásához használt adatbázis-infrastruktúrától (MySQL, MongoDB, MSSQL vagy más) függően különböző adatbázis-rendelkezésre állási és biztonsági mentési technikák választhatók ki.</span><span class="sxs-lookup"><span data-stu-id="5934c-357">Depending on the database infrastructure (MySQL, MongoDB, MSSQL or others) used to store the data, there will be different database availability and backup techniques available to choose from.</span></span>

<span data-ttu-id="5934c-358">Az integritás elérésének ajánlott módja a következők használata:</span><span class="sxs-lookup"><span data-stu-id="5934c-358">The recommended ways to achieve integrity are to use either:</span></span>
- <span data-ttu-id="5934c-359">Natív biztonsági mentési megoldás az adott adatbázishoz.</span><span class="sxs-lookup"><span data-stu-id="5934c-359">A native backup solution for the specific database.</span></span>
- <span data-ttu-id="5934c-360">Olyan biztonsági mentési megoldás, amely hivatalosan támogatja az alkalmazás által használt adatbázis-típus biztonsági mentését és helyreállítását.</span><span class="sxs-lookup"><span data-stu-id="5934c-360">A backup solution that officially supports backup and recovery of the database type used by your application.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="5934c-361">Ne tárolja a biztonsági mentési adatait ugyanarra a Azure Stack hub-példányra, ahol az alkalmazás adatai találhatók.</span><span class="sxs-lookup"><span data-stu-id="5934c-361">Do not store your backup data on the same Azure Stack Hub instance where your application data resides.</span></span> <span data-ttu-id="5934c-362">Az Azure Stack hub-példány teljes kimaradása szintén veszélyezteti a biztonsági mentéseket.</span><span class="sxs-lookup"><span data-stu-id="5934c-362">A complete outage of the Azure Stack Hub instance would also compromise your backups.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="5934c-363">Rendelkezésre állási szempontok</span><span class="sxs-lookup"><span data-stu-id="5934c-363">Availability considerations</span></span>

<span data-ttu-id="5934c-364">Az AK-n keresztül üzembe helyezett Azure Stack hub Kubernetes nem felügyelt szolgáltatás.</span><span class="sxs-lookup"><span data-stu-id="5934c-364">Kubernetes on Azure Stack Hub deployed via AKS Engine isn't a managed service.</span></span> <span data-ttu-id="5934c-365">Ez egy Kubernetes-fürt automatikus üzembe helyezése és konfigurálása az Azure infrastruktúra-szolgáltatás (IaaS) használatával.</span><span class="sxs-lookup"><span data-stu-id="5934c-365">It's an automated deployment and configuration of a Kubernetes cluster using Azure Infrastructure-as-a-Service (IaaS).</span></span> <span data-ttu-id="5934c-366">Ennek megfelelően a mögöttes infrastruktúrával megegyező rendelkezésre állást biztosít.</span><span class="sxs-lookup"><span data-stu-id="5934c-366">As such, it provides the same availability as the underlying infrastructure.</span></span>

<span data-ttu-id="5934c-367">Azure Stack hub-infrastruktúra már rugalmas a hibákhoz, és olyan képességeket biztosít, mint például a rendelkezésre állási csoportok, amelyek lehetővé teszi az összetevők több [hiba és frissítési tartomány](/azure-stack/user/azure-stack-vm-considerations#high-availability)közötti elosztását</span><span class="sxs-lookup"><span data-stu-id="5934c-367">Azure Stack Hub infrastructure is already resilient to failures, and provides capabilities like Availability Sets to distribute components across multiple [fault and update domains](/azure-stack/user/azure-stack-vm-considerations#high-availability).</span></span> <span data-ttu-id="5934c-368">Az alapul szolgáló technológia (feladatátvételi fürtszolgáltatás) azonban továbbra is leállást okoz a virtuális gépeken egy érintett fizikai kiszolgálón, ha hardverhiba van.</span><span class="sxs-lookup"><span data-stu-id="5934c-368">But the underlying technology (failover clustering) still incurs some downtime for VMs on an impacted physical server, if there's a hardware failure.</span></span>

<span data-ttu-id="5934c-369">Célszerű üzembe helyezni az üzemi Kubernetes-fürtöt, valamint a munkaterhelést két (vagy több) fürtön.</span><span class="sxs-lookup"><span data-stu-id="5934c-369">It's a good practice to deploy your production Kubernetes cluster as well as the workload to two (or more) clusters.</span></span> <span data-ttu-id="5934c-370">Ezeket a fürtöket különböző helyeken vagy adatközpontokban kell üzemeltetni, és olyan technológiákat kell használni, mint az Azure Traffic Manager a felhasználók a fürt válaszideje vagy földrajz alapján történő továbbítására.</span><span class="sxs-lookup"><span data-stu-id="5934c-370">These clusters should be hosted in different locations or datacenters, and use technologies like Azure Traffic Manager to route users based on cluster response time or based on geography.</span></span>

![A Traffic Manager használata a forgalmi folyamatok vezérléséhez](media/pattern-highly-available-kubernetes/aks-azure-traffic-manager.png)

<span data-ttu-id="5934c-372">Azok az ügyfelek, akik egyetlen Kubernetes-fürttel rendelkeznek, általában egy adott alkalmazás szolgáltatás IP-címéhez vagy DNS-nevéhez csatlakoznak.</span><span class="sxs-lookup"><span data-stu-id="5934c-372">Customers who have a single Kubernetes cluster typically connect to the service IP or DNS name of a given application.</span></span> <span data-ttu-id="5934c-373">Több fürtből álló telepítés esetén az ügyfeleknek csatlakozniuk kell egy Traffic Manager DNS-névhez, amely az egyes Kubernetes-fürtök szolgáltatásaira/beléptetésére mutat.</span><span class="sxs-lookup"><span data-stu-id="5934c-373">In a multi-cluster deployment, customers should connect to a Traffic Manager DNS name that points to the services/ingress on each Kubernetes cluster.</span></span>

![Traffic Manager használata a helyszíni fürtre való átirányításhoz](media/pattern-highly-available-kubernetes/aks-azure-traffic-manager-on-premises.png)

> [!NOTE]
> <span data-ttu-id="5934c-375">Ez a minta az [Azure-beli (felügyelt) AK-fürtök esetében is ajánlott eljárás](/azure/aks/operator-best-practices-multi-region#plan-for-multiregion-deployment).</span><span class="sxs-lookup"><span data-stu-id="5934c-375">This pattern is also a [best practice for (managed) AKS clusters in Azure](/azure/aks/operator-best-practices-multi-region#plan-for-multiregion-deployment).</span></span>

<span data-ttu-id="5934c-376">Maga a Kubernetes-fürt, amely az KABAi motoron keresztül lett üzembe helyezve, legalább három fő csomópontból és két feldolgozó csomópontból állhat.</span><span class="sxs-lookup"><span data-stu-id="5934c-376">The Kubernetes cluster itself, deployed via AKS Engine, should consist of at least three master nodes and two worker nodes.</span></span>

## <a name="identity-and-security-considerations"></a><span data-ttu-id="5934c-377">Identitás-és biztonsági megfontolások</span><span class="sxs-lookup"><span data-stu-id="5934c-377">Identity and security considerations</span></span>

<span data-ttu-id="5934c-378">Az identitás és a biztonság fontos témakörök.</span><span class="sxs-lookup"><span data-stu-id="5934c-378">Identity and security are important topics.</span></span> <span data-ttu-id="5934c-379">Különösen akkor, ha a megoldás független Azure Stack hub-példányokra terjed ki.</span><span class="sxs-lookup"><span data-stu-id="5934c-379">Especially when the solution spans independent Azure Stack Hub instances.</span></span> <span data-ttu-id="5934c-380">A Kubernetes és az Azure (beleértve az Azure Stack hubot is) különböző mechanizmusokkal rendelkezik a szerepköralapú hozzáférés-vezérléshez (RBAC):</span><span class="sxs-lookup"><span data-stu-id="5934c-380">Kubernetes and Azure (including Azure Stack Hub) both have distinct mechanisms for role-based access control (RBAC):</span></span>

- <span data-ttu-id="5934c-381">Az Azure RBAC az Azure-ban (és Azure Stack hub-ban) lévő erőforrásokhoz való hozzáférést szabályozza, beleértve az új Azure-erőforrások létrehozásának lehetőségét is.</span><span class="sxs-lookup"><span data-stu-id="5934c-381">Azure RBAC controls access to resources in Azure (and Azure Stack Hub), including the ability to create new Azure resources.</span></span> <span data-ttu-id="5934c-382">Engedélyek rendelhetők felhasználókhoz, csoportokhoz vagy egyszerű szolgáltatásokhoz.</span><span class="sxs-lookup"><span data-stu-id="5934c-382">Permissions can be assigned to users, groups, or service principals.</span></span> <span data-ttu-id="5934c-383">(Az egyszerű szolgáltatásnév az alkalmazások által használt biztonsági identitás.)</span><span class="sxs-lookup"><span data-stu-id="5934c-383">(A service principal is a security identity used by applications.)</span></span>
- <span data-ttu-id="5934c-384">A Kubernetes RBAC a Kubernetes API-ra irányítja az engedélyeket.</span><span class="sxs-lookup"><span data-stu-id="5934c-384">Kubernetes RBAC controls permissions to the Kubernetes API.</span></span> <span data-ttu-id="5934c-385">A hüvelyek és a hüvelyek listázása például olyan műveletek, amelyek a RBAC használatával engedélyezhetők (vagy megtagadhatják) a felhasználók számára.</span><span class="sxs-lookup"><span data-stu-id="5934c-385">For example, creating pods and listing pods are actions that can be authorized (or denied) to a user through RBAC.</span></span> <span data-ttu-id="5934c-386">Ahhoz, hogy Kubernetes engedélyeket rendeljen a felhasználókhoz, létre kell hoznia a szerepköröket és a szerepkör-kötéseket.</span><span class="sxs-lookup"><span data-stu-id="5934c-386">To assign Kubernetes permissions to users, you create roles and role bindings.</span></span>

<span data-ttu-id="5934c-387">**Azure Stack hub identitás-és RBAC**</span><span class="sxs-lookup"><span data-stu-id="5934c-387">**Azure Stack Hub identity and RBAC**</span></span>

<span data-ttu-id="5934c-388">Azure Stack hub két identitás-szolgáltatói lehetőséget biztosít.</span><span class="sxs-lookup"><span data-stu-id="5934c-388">Azure Stack Hub provides two identity provider choices.</span></span> <span data-ttu-id="5934c-389">A használt szolgáltató a környezettől függ, attól függetlenül, hogy csatlakoztatott vagy leválasztott környezetben fut-e:</span><span class="sxs-lookup"><span data-stu-id="5934c-389">The provider you use depends on the environment and whether running in a connected or disconnected environment:</span></span>

- <span data-ttu-id="5934c-390">Az Azure AD-t csak csatlakoztatott környezetben lehet használni.</span><span class="sxs-lookup"><span data-stu-id="5934c-390">Azure AD - can only be used in a connected environment.</span></span>
- <span data-ttu-id="5934c-391">Az ADFS-t egy hagyományos Active Directory erdőhöz is használhatja, amely csatlakoztatott vagy leválasztott környezetben is használható.</span><span class="sxs-lookup"><span data-stu-id="5934c-391">ADFS to a traditional Active Directory forest - can be used in both a connected or disconnected environment.</span></span>

<span data-ttu-id="5934c-392">Az identitás-szolgáltató kezeli a felhasználókat és csoportokat, beleértve a hitelesítést és az erőforrások elérésének engedélyezését.</span><span class="sxs-lookup"><span data-stu-id="5934c-392">The identity provider manages users and groups, including authentication and authorization for accessing resources.</span></span> <span data-ttu-id="5934c-393">Hozzáférés adható Azure Stack hub-erőforrásokhoz, például előfizetésekhez, erőforráscsoportokhoz és egyéni erőforrásokhoz, például virtuális gépekhez vagy terheléselosztóhoz.</span><span class="sxs-lookup"><span data-stu-id="5934c-393">Access can be granted to Azure Stack Hub resources like subscriptions, resource groups, and individual resources like VMs or load balancers.</span></span> <span data-ttu-id="5934c-394">Ha konzisztens hozzáférési modellt szeretne használni, érdemes megfontolnia, hogy ugyanazt a csoportot használja (közvetlen vagy beágyazott) az összes Azure Stack-hubhoz.</span><span class="sxs-lookup"><span data-stu-id="5934c-394">To have a consistent access model, you should consider using the same groups (either direct or nested) for all Azure Stack Hubs.</span></span> <span data-ttu-id="5934c-395">Íme egy konfigurációs példa:</span><span class="sxs-lookup"><span data-stu-id="5934c-395">Here's a configuration example:</span></span>

![beágyazott HRE-csoportok az Azure stack hub-vel](media/pattern-highly-available-kubernetes/azure-stack-azure-ad-nested-groups.png)

<span data-ttu-id="5934c-397">A példa egy dedikált csoportot tartalmaz (HRE vagy ADFS használatával) egy adott célra.</span><span class="sxs-lookup"><span data-stu-id="5934c-397">The example contains a dedicated group (using AAD or ADFS) for a specific purpose.</span></span> <span data-ttu-id="5934c-398">Ha például a Kubernetes-fürt infrastruktúráját tartalmazó erőforráscsoporthoz közreműködői engedélyeket szeretne adni egy adott Azure Stack hub-példányon (itt "Seattle K8s cluster közreműködő").</span><span class="sxs-lookup"><span data-stu-id="5934c-398">For example, to provide Contributor permissions for the Resource Group that contains our Kubernetes cluster infrastructure on a specific Azure Stack Hub instance (here "Seattle K8s Cluster Contributor").</span></span> <span data-ttu-id="5934c-399">Ezeket a csoportokat ezután egy teljes csoportba ágyazzák be, amely az egyes Azure Stack hubok "alcsoportait" tartalmazza.</span><span class="sxs-lookup"><span data-stu-id="5934c-399">These groups are then nested into an overall group that contains the "subgroups" for each Azure Stack Hub.</span></span>

<span data-ttu-id="5934c-400">A minta felhasználónk immár "közreműködői" engedélyekkel rendelkezik mindkét olyan erőforrás-csoporthoz, amely a Kubernetes-infrastruktúra teljes készletét tartalmazza.</span><span class="sxs-lookup"><span data-stu-id="5934c-400">Our sample user will now have "Contributor" permissions to both Resources Groups that contain the entire set of Kubernetes infrastructure resources.</span></span> <span data-ttu-id="5934c-401">A felhasználó Azure Stack hub-példányokon is hozzáférhet az erőforrásokhoz, mert a példányok ugyanazzal az identitás-szolgáltatóval rendelkeznek.</span><span class="sxs-lookup"><span data-stu-id="5934c-401">The user will have access to resources on both Azure Stack Hub instances, because the instances share the same identity provider.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="5934c-402">Ezek az engedélyek csak Azure Stack központot és a rajta üzembe helyezett erőforrásokat érintik.</span><span class="sxs-lookup"><span data-stu-id="5934c-402">These permissions affect only Azure Stack Hub and some of the resources deployed on top of it.</span></span> <span data-ttu-id="5934c-403">Az ilyen szintű hozzáféréssel rendelkező felhasználók nagy károkat okozhatnak, de nem férhetnek hozzá a Kubernetes IaaS virtuális gépekhez és a Kubernetes API-hoz anélkül, hogy további hozzáférésre lenne szükség a Kubernetes-telepítéshez.</span><span class="sxs-lookup"><span data-stu-id="5934c-403">A user who has this level of access can do a lot of harm, but cannot access the Kubernetes IaaS VMs nor the Kubernetes API without additional access to the Kubernetes deployment.</span></span>

<span data-ttu-id="5934c-404">**Kubernetes-identitás és RBAC**</span><span class="sxs-lookup"><span data-stu-id="5934c-404">**Kubernetes identity and RBAC**</span></span>

<span data-ttu-id="5934c-405">A Kubernetes-fürt alapértelmezés szerint nem ugyanazt az identitás-szolgáltatót használja, mint a Azure Stack hub.</span><span class="sxs-lookup"><span data-stu-id="5934c-405">A Kubernetes cluster, by default, doesn't use the same Identity Provider as the underlaying Azure Stack Hub.</span></span> <span data-ttu-id="5934c-406">A Kubernetes-fürtöt, a főkiszolgálót és a feldolgozó csomópontokat futtató virtuális gépek a fürt központi telepítése során megadott SSH-kulcsot használják.</span><span class="sxs-lookup"><span data-stu-id="5934c-406">The VMs hosting the Kubernetes cluster, the master, and worker nodes, use the SSH Key that is specified during the deployment of the cluster.</span></span> <span data-ttu-id="5934c-407">Ez az SSH-kulcs szükséges ahhoz, hogy SSH-kapcsolaton keresztül csatlakozhasson ezekhez a csomópontokhoz.</span><span class="sxs-lookup"><span data-stu-id="5934c-407">This SSH key is required to connect to these nodes using SSH.</span></span>

<span data-ttu-id="5934c-408">A Kubernetes API-t (például a használatával érhető el `kubectl` ) a szolgáltatásfiók is védi, beleértve az alapértelmezett "Fürtfelügyelő" szolgáltatásfiókot is.</span><span class="sxs-lookup"><span data-stu-id="5934c-408">The Kubernetes API (for example, accessed by using `kubectl`) is also protected by service accounts including a default "cluster admin" service account.</span></span> <span data-ttu-id="5934c-409">A szolgáltatásfiók hitelesítő adatait kezdetben a `.kube/config` Kubernetes főcsomópontjain található fájlban tárolja a rendszer.</span><span class="sxs-lookup"><span data-stu-id="5934c-409">The credentials for this service account are initially stored in the `.kube/config` file on your Kubernetes master nodes.</span></span>

<span data-ttu-id="5934c-410">**Titkok kezelése és alkalmazás hitelesítő adatai**</span><span class="sxs-lookup"><span data-stu-id="5934c-410">**Secrets management and application credentials**</span></span>

<span data-ttu-id="5934c-411">A titkokat, például a kapcsolódási karakterláncokat vagy az adatbázis hitelesítő adatait több lehetőség is tárolhatja, többek között:</span><span class="sxs-lookup"><span data-stu-id="5934c-411">To store secrets like connection strings or database credentials there are several choices, including:</span></span>

- <span data-ttu-id="5934c-412">Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="5934c-412">Azure Key Vault</span></span>
- <span data-ttu-id="5934c-413">A Kubernetes titkos kódjai</span><span class="sxs-lookup"><span data-stu-id="5934c-413">Kubernetes Secrets</span></span>
- <span data-ttu-id="5934c-414">külső megoldások, például a HashiCorp-tároló (Kubernetes-on futó)</span><span class="sxs-lookup"><span data-stu-id="5934c-414">3rd-Party solutions like HashiCorp Vault (running on Kubernetes)</span></span>

<span data-ttu-id="5934c-415">Ne tárolja a titkos kulcsokat vagy a hitelesítő adatokat a konfigurációs fájlokban, az alkalmazás kódjában vagy a parancsfájlokon belül.</span><span class="sxs-lookup"><span data-stu-id="5934c-415">Do not store secrets or credentials in plaintext in your configuration files, application code, or within scripts.</span></span> <span data-ttu-id="5934c-416">És ne tárolja azokat a verziókövetés rendszerében.</span><span class="sxs-lookup"><span data-stu-id="5934c-416">And do not store them in a version control system.</span></span> <span data-ttu-id="5934c-417">Ehelyett a központi telepítési automatizálásnak szükség szerint le kell kérnie a titkokat.</span><span class="sxs-lookup"><span data-stu-id="5934c-417">Instead, the deployment automation should retrieve the secrets as needed.</span></span>

## <a name="patch-and-update"></a><span data-ttu-id="5934c-418">Javítás és frissítés</span><span class="sxs-lookup"><span data-stu-id="5934c-418">Patch and update</span></span>

<span data-ttu-id="5934c-419">Az Azure Kubernetes szolgáltatásban a **patch és a Update (PNU)** folyamat részben automatizált.</span><span class="sxs-lookup"><span data-stu-id="5934c-419">The **Patch and Update (PNU)** process in Azure Kubernetes Service is partially automated.</span></span> <span data-ttu-id="5934c-420">A Kubernetes-verziók frissítése manuálisan történik, a biztonsági frissítéseket pedig automatikusan alkalmazza a rendszer.</span><span class="sxs-lookup"><span data-stu-id="5934c-420">Kubernetes version upgrades are triggered manually, while security updates are applied automatically.</span></span> <span data-ttu-id="5934c-421">Ezek a frissítések operációsrendszer-biztonsági javításokat vagy kernel-frissítéseket is tartalmazhatnak.</span><span class="sxs-lookup"><span data-stu-id="5934c-421">These updates can include OS security fixes or kernel updates.</span></span> <span data-ttu-id="5934c-422">Az AK nem újraindítja automatikusan ezeket a Linux-csomópontokat a frissítési folyamat befejezéséhez.</span><span class="sxs-lookup"><span data-stu-id="5934c-422">AKS doesn't automatically reboot these Linux nodes to complete the update process.</span></span> 

<span data-ttu-id="5934c-423">A Azure Stack hub alhálózatán keresztül üzembe helyezett Kubernetes-fürtök PNU folyamata nem felügyelt, és a fürt operátorának feladata.</span><span class="sxs-lookup"><span data-stu-id="5934c-423">The PNU process for a Kubernetes cluster deployed using AKS Engine on Azure Stack Hub is unmanaged, and is the responsibility of the cluster operator.</span></span> 

<span data-ttu-id="5934c-424">Az AK-motor segíti a két legfontosabb feladatot:</span><span class="sxs-lookup"><span data-stu-id="5934c-424">AKS Engine helps with the two most important tasks:</span></span>

- [<span data-ttu-id="5934c-425">Frissítés egy újabb Kubernetes és az alap operációs rendszer rendszerképének verziójára</span><span class="sxs-lookup"><span data-stu-id="5934c-425">Upgrade to a newer Kubernetes and base OS image version</span></span>](/azure-stack/user/azure-stack-kubernetes-aks-engine-upgrade#steps-to-upgrade-to-a-newer-kubernetes-version)
- [<span data-ttu-id="5934c-426">Csak az alap operációs rendszer rendszerképének frissítése</span><span class="sxs-lookup"><span data-stu-id="5934c-426">Upgrade the base OS image only</span></span>](/azure-stack/user/azure-stack-kubernetes-aks-engine-upgrade#steps-to-only-upgrade-the-os-image)

<span data-ttu-id="5934c-427">Az újabb alap operációsrendszer-lemezképek tartalmazzák a legújabb operációsrendszer-biztonsági javításokat és a kernel frissítéseit.</span><span class="sxs-lookup"><span data-stu-id="5934c-427">Newer base OS images contain the latest OS security fixes and kernel updates.</span></span> 

<span data-ttu-id="5934c-428">A [felügyelet nélküli frissítési](https://wiki.debian.org/UnattendedUpgrades) mechanizmus automatikusan telepíti azokat a biztonsági frissítéseket, amelyeket a rendszer az új alap operációsrendszer-rendszerkép verziója előtt szabadít fel az Azure stack hub piactéren.</span><span class="sxs-lookup"><span data-stu-id="5934c-428">The [Unattended Upgrade](https://wiki.debian.org/UnattendedUpgrades) mechanism automatically installs security updates that are released before a new base OS image version is available in the Azure Stack Hub Marketplace.</span></span> <span data-ttu-id="5934c-429">A felügyelet nélküli frissítés alapértelmezés szerint engedélyezve van, és automatikusan telepíti a biztonsági frissítéseket, de nem indítják újra a Kubernetes-fürt csomópontjait.</span><span class="sxs-lookup"><span data-stu-id="5934c-429">Unattended upgrade is enabled by default and installs security updates automatically, but does not reboot the Kubernetes cluster nodes.</span></span> <span data-ttu-id="5934c-430">A csomópontok újraindítása automatizálható a nyílt forráskódú [ **K** Ubernetes újraindítási **RE** **D** Aemon (kured)](/azure/aks/node-updates-kured)használatával.</span><span class="sxs-lookup"><span data-stu-id="5934c-430">Rebooting the nodes can be automated using the open-source [**K** Ubernetes **RE** boot **D** aemon (kured))](/azure/aks/node-updates-kured).</span></span> <span data-ttu-id="5934c-431">Kured az újraindítást igénylő Linux-csomópontokra, majd automatikusan kezeli a futó hüvelyek és a csomópont-újraindítási folyamat újraütemezését.</span><span class="sxs-lookup"><span data-stu-id="5934c-431">Kured watches for Linux nodes that require a reboot, then automatically handle the rescheduling of running pods and node reboot process.</span></span>

## <a name="deployment-cicd-considerations"></a><span data-ttu-id="5934c-432">Üzembe helyezési (CI/CD) megfontolások</span><span class="sxs-lookup"><span data-stu-id="5934c-432">Deployment (CI/CD) considerations</span></span>

<span data-ttu-id="5934c-433">Az Azure és a Azure Stack hub ugyanazokat a Azure Resource Manager REST API-kat teszi elérhetővé.</span><span class="sxs-lookup"><span data-stu-id="5934c-433">Azure and Azure Stack Hub expose the same Azure Resource Manager REST APIs.</span></span> <span data-ttu-id="5934c-434">Ezek az API-k minden más Azure-felhőhöz (Azure, Azure China 21Vianet, Azure Government) vannak címezve.</span><span class="sxs-lookup"><span data-stu-id="5934c-434">These APIs are addressed like any other Azure cloud (Azure, Azure China 21Vianet, Azure Government).</span></span> <span data-ttu-id="5934c-435">Lehetnek eltérések a felhők közötti API-verziók között, és a Azure Stack hub csak a szolgáltatások egy részét biztosítja.</span><span class="sxs-lookup"><span data-stu-id="5934c-435">There may be differences in API versions between clouds, and Azure Stack Hub provides only a subset of services.</span></span> <span data-ttu-id="5934c-436">A felügyeleti végpont URI-ja különbözik az egyes felhőknek és az Azure Stack hub minden példányának.</span><span class="sxs-lookup"><span data-stu-id="5934c-436">The management endpoint URI is also different for each cloud, and each instance of Azure Stack Hub.</span></span>

<span data-ttu-id="5934c-437">A fentiekben említett enyhe eltérések mellett Azure Resource Manager REST API-k egységes módszert biztosítanak az Azure és az Azure Stack hub szolgáltatással való kommunikációra.</span><span class="sxs-lookup"><span data-stu-id="5934c-437">Aside from the subtle differences mentioned, Azure Resource Manager REST APIs provide a consistent way to interact with both Azure and Azure Stack Hub.</span></span> <span data-ttu-id="5934c-438">Ugyanazokat az eszközöket használhatja itt, mint bármely más Azure-felhőben.</span><span class="sxs-lookup"><span data-stu-id="5934c-438">The same set of tools can be used here as would be used with any other Azure cloud.</span></span> <span data-ttu-id="5934c-439">Az Azure DevOps, például a Jenkins vagy a PowerShell használatával a szolgáltatások üzembe helyezése és összehangolása Azure Stack hubhoz.</span><span class="sxs-lookup"><span data-stu-id="5934c-439">You can use Azure DevOps, tools like Jenkins, or PowerShell, to deploy and orchestrate services to Azure Stack Hub.</span></span>

<span data-ttu-id="5934c-440">**Megfontolások**</span><span class="sxs-lookup"><span data-stu-id="5934c-440">**Considerations**</span></span>

<span data-ttu-id="5934c-441">Az Azure Stack hub központi telepítésének egyik fő különbsége az internetes hozzáférhetőség kérdése.</span><span class="sxs-lookup"><span data-stu-id="5934c-441">One of the major differences when it comes to Azure Stack Hub deployments is the question of Internet accessibility.</span></span> <span data-ttu-id="5934c-442">Az Internet hozzáférhetősége határozza meg, hogy ki kell-e választania egy Microsoft által üzemeltetett vagy saját üzemeltetésű Build ügynököt a CI/CD-feladatokhoz.</span><span class="sxs-lookup"><span data-stu-id="5934c-442">Internet accessibility determines whether to select a Microsoft-hosted or a self-hosted build agent for your CI/CD jobs.</span></span>

<span data-ttu-id="5934c-443">A saját üzemeltetésű ügynök a Azure Stack hub (IaaS VM) vagy egy olyan hálózati alhálózat felett futhat, amely hozzáfér Azure Stack hubhoz.</span><span class="sxs-lookup"><span data-stu-id="5934c-443">A self-hosted agent can run on top of Azure Stack Hub (as an IaaS VM) or in a network subnet that can access Azure Stack Hub.</span></span> <span data-ttu-id="5934c-444">A különbségekről további információt az [Azure-folyamatok ügynököknél](/azure/devops/pipelines/agents/agents) olvashat.</span><span class="sxs-lookup"><span data-stu-id="5934c-444">Go to [Azure Pipelines agents](/azure/devops/pipelines/agents/agents) to learn more about the differences.</span></span>

<span data-ttu-id="5934c-445">Az alábbi képen eldöntheti, hogy szüksége van-e egy saját üzemeltetésű vagy egy Microsoft által üzemeltetett Build-ügynökre:</span><span class="sxs-lookup"><span data-stu-id="5934c-445">The following image helps you to decide if you need a self-hosted or a Microsoft-hosted build agent:</span></span>

![Saját üzemeltetésű Build-ügynökök igen vagy nem](media/pattern-highly-available-kubernetes/aks-on-stack-self-hosted-build-agents-yes-or-no.png)

- <span data-ttu-id="5934c-447">Elérhetők az Azure Stack hub felügyeleti végpontok az interneten keresztül?</span><span class="sxs-lookup"><span data-stu-id="5934c-447">Are the Azure Stack Hub management endpoints accessible via Internet?</span></span>
  - <span data-ttu-id="5934c-448">Igen: az Azure-folyamatokat Microsoft által üzemeltetett ügynökökkel is használhatjuk Azure Stack hubhoz való kapcsolódáshoz.</span><span class="sxs-lookup"><span data-stu-id="5934c-448">Yes: We can use Azure Pipelines with Microsoft-hosted agents to connect to Azure Stack Hub.</span></span>
  - <span data-ttu-id="5934c-449">Nem: szükség van olyan önkiszolgáló ügynökökre, amelyek csatlakozhatnak Azure Stack hub felügyeleti végpontokhoz.</span><span class="sxs-lookup"><span data-stu-id="5934c-449">No: We need self-hosted agents that can connect to Azure Stack Hub's management endpoints.</span></span>
- <span data-ttu-id="5934c-450">Elérhető a Kubernetes-fürt az interneten keresztül?</span><span class="sxs-lookup"><span data-stu-id="5934c-450">Is our Kubernetes cluster accessible via the Internet?</span></span>
  - <span data-ttu-id="5934c-451">Igen: az Azure-folyamatokat Microsoft által üzemeltetett ügynökökkel is használhatja a Kubernetes API-végponttal való közvetlen interakcióhoz.</span><span class="sxs-lookup"><span data-stu-id="5934c-451">Yes: We can use Azure Pipelines with Microsoft-hosted agents to interact directly with Kubernetes API endpoint.</span></span>
  - <span data-ttu-id="5934c-452">Nem: szükség van olyan önkiszolgáló ügynökökre, amelyek csatlakozhatnak a Kubernetes-fürt API-végponthoz.</span><span class="sxs-lookup"><span data-stu-id="5934c-452">No: We need self-hosted Agents that can connect to the Kubernetes cluster API endpoint.</span></span>

<span data-ttu-id="5934c-453">Olyan esetekben, amikor az Azure Stack hub felügyeleti végpontok és a Kubernetes API az interneten keresztül elérhető, a központi telepítés Microsoft által üzemeltetett ügynököt használhat.</span><span class="sxs-lookup"><span data-stu-id="5934c-453">In scenarios where the Azure Stack Hub management endpoints and Kubernetes API are accessible via the internet, the deployment can use a Microsoft-hosted agent.</span></span> <span data-ttu-id="5934c-454">Ez az üzembe helyezés az alkalmazás architektúráját fogja eredményezni a következőképpen:</span><span class="sxs-lookup"><span data-stu-id="5934c-454">This deployment will result in an application architecture as follows:</span></span>

<span data-ttu-id="5934c-455">[![Nyilvános architektúra – áttekintés](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="5934c-455">[![Public architecture overview](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png#lightbox)</span></span>

<span data-ttu-id="5934c-456">Ha az Azure Resource Manager-végpontok, a Kubernetes API vagy mindkettő nem érhető el közvetlenül az interneten keresztül, a folyamat lépéseinek futtatásához kihasználhatjuk a saját üzemeltetésű Build ügynököt.</span><span class="sxs-lookup"><span data-stu-id="5934c-456">If the Azure Resource Manager endpoints, Kubernetes API, or both aren't directly accessible via the Internet, we can leverage a self-hosted build agent to run the pipeline steps.</span></span> <span data-ttu-id="5934c-457">Ennek a kialakításnak kevesebb kapcsolatra van szüksége, és csak helyszíni hálózati kapcsolattal helyezhető üzembe Azure Resource Manager végpontokhoz és a Kubernetes API-hoz:</span><span class="sxs-lookup"><span data-stu-id="5934c-457">This design needs less connectivity, and can be deployed with only on-premises network connectivity to Azure Resource Manager endpoints and the Kubernetes API:</span></span>

<span data-ttu-id="5934c-458">[![Helyszíni architektúra áttekintése](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="5934c-458">[![On-prem architecture overview](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png#lightbox)</span></span>

> [!NOTE]
> <span data-ttu-id="5934c-459">**Mi a helyzet a leválasztott forgatókönyvekkel?**</span><span class="sxs-lookup"><span data-stu-id="5934c-459">**What about disconnected scenarios?**</span></span> <span data-ttu-id="5934c-460">Olyan helyzetekben, ahol Azure Stack hub vagy Kubernetes, vagy mindkettő nem rendelkezik internetre irányuló felügyeleti végpontokkal, továbbra is használhatja az Azure DevOps-t az üzemelő példányokhoz.</span><span class="sxs-lookup"><span data-stu-id="5934c-460">In scenarios where either Azure Stack Hub or Kubernetes or both of them do not have internet-facing management endpoints, it is still possible to use Azure DevOps for your deployments.</span></span> <span data-ttu-id="5934c-461">Használhat saját üzemeltetésű ügynököt is (amely a helyszínen vagy a Azure Stack hub-on futtatott DevOps-ügynök) vagy egy teljesen helyi Azure DevOps Server a helyszínen.</span><span class="sxs-lookup"><span data-stu-id="5934c-461">You can either use a self-hosted Agent Pool (which is a DevOps Agent running on-premises or on Azure Stack Hub itself) or a completly self-hosted Azure DevOps Server on-premises.</span></span> <span data-ttu-id="5934c-462">A saját üzemeltetésű ügynöknek csak kimenő HTTPS (TCP/443) internetkapcsolatra van szüksége.</span><span class="sxs-lookup"><span data-stu-id="5934c-462">The self-hosted agent needs only outbound HTTPS (TCP/443) Internet connectivity.</span></span>

<span data-ttu-id="5934c-463">A minta egy Kubernetes-fürtöt is használhat (az AK-motorral üzembe helyezett és összehangolt) minden Azure Stack hub-példányon.</span><span class="sxs-lookup"><span data-stu-id="5934c-463">The pattern can use a Kubernetes cluster (deployed and orchestrated with AKS engine) on each Azure Stack Hub instance.</span></span> <span data-ttu-id="5934c-464">Egy olyan alkalmazást tartalmaz, amely egy frontendből, egy közepes szintű háttér-szolgáltatásokból (például MongoDB) és egy Nginx-alapú bejövő adatkezelőből áll.</span><span class="sxs-lookup"><span data-stu-id="5934c-464">It includes an application consisting of a frontend, a mid-tier, backend services (for example MongoDB), and an nginx-based Ingress Controller.</span></span> <span data-ttu-id="5934c-465">A K8s-fürtön üzemeltetett adatbázis helyett a "külső adattárak" is kihasználható.</span><span class="sxs-lookup"><span data-stu-id="5934c-465">Instead of using a database hosted on the K8s cluster, you can leverage "external data stores".</span></span> <span data-ttu-id="5934c-466">Az adatbázis-beállítások közé tartozik a MySQL, a SQL Server vagy az Azure Stack hub vagy a IaaS szolgáltatáson kívül üzemeltetett adatbázis.</span><span class="sxs-lookup"><span data-stu-id="5934c-466">Database options include MySQL, SQL Server, or any kind of database hosted outside of Azure Stack Hub or in IaaS.</span></span> <span data-ttu-id="5934c-467">Az ehhez hasonló konfigurációk nem tartoznak ide.</span><span class="sxs-lookup"><span data-stu-id="5934c-467">Configurations like this aren't in scope here.</span></span>

## <a name="partner-solutions"></a><span data-ttu-id="5934c-468">Partneri megoldások</span><span class="sxs-lookup"><span data-stu-id="5934c-468">Partner solutions</span></span>

<span data-ttu-id="5934c-469">Vannak olyan Microsoft partneri megoldások, amelyek kiterjeszthetik Azure Stack hub képességeit.</span><span class="sxs-lookup"><span data-stu-id="5934c-469">There are Microsoft Partner solutions that can extend the capabilities of Azure Stack Hub.</span></span> <span data-ttu-id="5934c-470">Ezek a megoldások a Kubernetes-fürtökön futó alkalmazások központi telepítése során hasznosak.</span><span class="sxs-lookup"><span data-stu-id="5934c-470">These solutions have been found useful in deployments of applications running on Kubernetes clusters.</span></span>  

## <a name="storage-and-data-solutions"></a><span data-ttu-id="5934c-471">Tárolási és adatkezelési megoldások</span><span class="sxs-lookup"><span data-stu-id="5934c-471">Storage and data solutions</span></span>

<span data-ttu-id="5934c-472">Az [adatkezelési és tárolási megfontolásokban](#data-and-storage-considerations)leírtak szerint Azure stack hub jelenleg nem rendelkezik natív megoldással a tárterület több példányra való replikálásához.</span><span class="sxs-lookup"><span data-stu-id="5934c-472">As described in [Data and storage considerations](#data-and-storage-considerations), Azure Stack Hub currently doesn't have a native solution to replicate storage across multiple instances.</span></span> <span data-ttu-id="5934c-473">Az Azure-tól eltérően a tárterület több régióban való replikálásának lehetősége nem létezik.</span><span class="sxs-lookup"><span data-stu-id="5934c-473">Unlike Azure, the capability of replicating storage across multiple regions does not exist.</span></span> <span data-ttu-id="5934c-474">Azure Stack hub-ban minden példány a saját különböző felhője.</span><span class="sxs-lookup"><span data-stu-id="5934c-474">In Azure Stack Hub, each instance is its own distinct cloud.</span></span> <span data-ttu-id="5934c-475">A megoldások azonban olyan Microsoft-partnerektől érhetők el, amelyek lehetővé teszik a tárolók replikálását Azure Stack hubok és az Azure között.</span><span class="sxs-lookup"><span data-stu-id="5934c-475">However, solutions are available from Microsoft Partners that enable storage replication across Azure Stack Hubs and Azure.</span></span> 

<span data-ttu-id="5934c-476">**SKÁLÁZÁS**</span><span class="sxs-lookup"><span data-stu-id="5934c-476">**SCALITY**</span></span>

<span data-ttu-id="5934c-477">A [skálázhatóság](https://www.scality.com/) olyan webes tárterületet biztosít, amely a 2009-as óta digitális üzleti vállalkozásokat üzemeltet.</span><span class="sxs-lookup"><span data-stu-id="5934c-477">[Scality](https://www.scality.com/) delivers web-scale storage that has powered digital businesses since 2009.</span></span> <span data-ttu-id="5934c-478">A skálázási kör, a szoftveresen definiált tárolás, a hagyományos x86-kiszolgálók korlátlan tárolási készletbe kapcsolása bármilyen típusú adattípushoz – fájl és objektum – a petabyte skálán.</span><span class="sxs-lookup"><span data-stu-id="5934c-478">The Scality RING, our software-defined storage, turns commodity x86 servers into an unlimited storage pool for any type of data –file and object– at petabyte scale.</span></span>

<span data-ttu-id="5934c-479">**CLOUDIAN**</span><span class="sxs-lookup"><span data-stu-id="5934c-479">**CLOUDIAN**</span></span>

<span data-ttu-id="5934c-480">A [Cloudian](https://www.cloudian.com/) leegyszerűsíti a nagyvállalati tárterületet, és korlátlanul méretezhető tárterületet biztosít, amely egyetlen, könnyen felügyelt környezetbe összevonja a nagyméretű adatkészleteket.</span><span class="sxs-lookup"><span data-stu-id="5934c-480">[Cloudian](https://www.cloudian.com/) simplifies enterprise storage with limitless scalable storage that consolidates massive data sets to a single, easily managed environment.</span></span>

## <a name="next-steps"></a><span data-ttu-id="5934c-481">Következő lépések</span><span class="sxs-lookup"><span data-stu-id="5934c-481">Next steps</span></span>

<span data-ttu-id="5934c-482">További információ a cikkben bemutatott fogalmakról:</span><span class="sxs-lookup"><span data-stu-id="5934c-482">To learn more about concepts introduced in this article:</span></span>

- <span data-ttu-id="5934c-483">[Több felhőre kiterjedő méretezési](pattern-cross-cloud-scale.md) és [földrajzilag elosztott alkalmazási minták](pattern-geo-distributed.md) Azure stack központban.</span><span class="sxs-lookup"><span data-stu-id="5934c-483">[Cross-cloud scaling](pattern-cross-cloud-scale.md) and [Geo-distributed app patterns](pattern-geo-distributed.md) in Azure Stack Hub.</span></span>
- <span data-ttu-id="5934c-484">[A Services architektúra az Azure Kubernetes szolgáltatásban (ak)](/azure/architecture/reference-architectures/microservices/aks).</span><span class="sxs-lookup"><span data-stu-id="5934c-484">[Microservices architecture on Azure Kubernetes Service (AKS)](/azure/architecture/reference-architectures/microservices/aks).</span></span>

<span data-ttu-id="5934c-485">Ha készen áll a megoldás tesztelésére, folytassa a [magas rendelkezésre állású Kubernetes-fürt telepítési útmutatóját](solution-deployment-guide-highly-available-kubernetes.md).</span><span class="sxs-lookup"><span data-stu-id="5934c-485">When you're ready to test the solution example, continue with the [High availability Kubernetes cluster deployment guide](solution-deployment-guide-highly-available-kubernetes.md).</span></span> <span data-ttu-id="5934c-486">A telepítési útmutató részletes útmutatást nyújt az összetevők üzembe helyezéséhez és teszteléséhez.</span><span class="sxs-lookup"><span data-stu-id="5934c-486">The deployment guide provides step-by-step instructions for deploying and testing its components.</span></span>